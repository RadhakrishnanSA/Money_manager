(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();var As={};const Ri={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const p=function(n,e){if(!n)throw Me(e)},Me=function(n){return new Error("Firebase Database ("+Ri.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const ki=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},xo=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const i=n[t++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=n[t++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=n[t++],o=n[t++],a=n[t++],l=((i&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const r=n[t++],o=n[t++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return e.join("")},Mn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<n.length;i+=3){const r=n[i],o=i+1<n.length,a=o?n[i+1]:0,l=i+2<n.length,c=l?n[i+2]:0,h=r>>2,u=(r&3)<<4|a>>4;let d=(a&15)<<2|c>>6,f=c&63;l||(f=64,o||(d=64)),s.push(t[h],t[u],t[d],t[f])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(ki(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):xo(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<n.length;){const r=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;const c=i<n.length?t[n.charAt(i)]:64;++i;const u=i<n.length?t[n.charAt(i)]:64;if(++i,r==null||a==null||c==null||u==null)throw new Po;const d=r<<2|a>>4;if(s.push(d),c!==64){const f=a<<4&240|c>>2;if(s.push(f),u!==64){const _=c<<6&192|u;s.push(_)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Po extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Di=function(n){const e=ki(n);return Mn.encodeByteArray(e,!0)},vt=function(n){return Di(n).replace(/\./g,"")},_n=function(n){try{return Mn.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Oo(n){return xi(void 0,n)}function xi(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!Mo(t)||(n[t]=xi(n[t],e[t]));return n}function Mo(n){return n!=="__proto__"}function Lo(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Fo=()=>Lo().__FIREBASE_DEFAULTS__,Bo=()=>{if(typeof process>"u"||typeof As>"u")return;const n=As.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},$o=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&_n(n[1]);return e&&JSON.parse(e)},Pi=()=>{try{return Fo()||Bo()||$o()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Wo=n=>{var e,t;return(t=(e=Pi())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Uo=n=>{const e=Wo(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},Oi=()=>{var n;return(n=Pi())===null||n===void 0?void 0:n.config};class rt{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function Ho(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",i=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},n);return[vt(JSON.stringify(t)),vt(JSON.stringify(o)),""].join(".")}function Vo(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Mi(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Vo())}function qo(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Go(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function jo(){return Ri.NODE_ADMIN===!0}function Li(){try{return typeof indexedDB=="object"}catch{return!1}}function Fi(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var r;e(((r=i.error)===null||r===void 0?void 0:r.message)||"")}}catch(t){e(t)}})}function zo(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}const Ko="FirebaseError";class we extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=Ko,Object.setPrototypeOf(this,we.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ft.prototype.create)}}class Ft{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],o=r?Yo(r,s):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new we(i,a,s)}}function Yo(n,e){return n.replace(Qo,(t,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const Qo=/\{\$([^}]+)}/g;function Ye(n){return JSON.parse(n)}function k(n){return JSON.stringify(n)}const Bi=function(n){let e={},t={},s={},i="";try{const r=n.split(".");e=Ye(_n(r[0])||""),t=Ye(_n(r[1])||""),i=r[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:i}},Xo=function(n){const e=Bi(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},Jo=function(n){const e=Bi(n).claims;return typeof e=="object"&&e.admin===!0};function K(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Re(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Rs(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Et(n,e,t){const s={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(s[i]=e.call(t,n[i],i,n));return s}function wt(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const i of t){if(!s.includes(i))return!1;const r=n[i],o=e[i];if(ks(r)&&ks(o)){if(!wt(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!t.includes(i))return!1;return!0}function ks(n){return n!==null&&typeof n=="object"}function Zo(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}class ea{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let u=0;u<16;u++)s[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)s[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const d=s[u-3]^s[u-8]^s[u-14]^s[u-16];s[u]=(d<<1|d>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,h;for(let u=0;u<80;u++){u<40?u<20?(c=a^r&(o^a),h=1518500249):(c=r^o^a,h=1859775393):u<60?(c=r&o|a&(r|o),h=2400959708):(c=r^o^a,h=3395469782);const d=(i<<5|i>>>27)+c+l+h+s[u]&4294967295;l=a,a=o,o=(r<<30|r>>>2)&4294967295,r=i,i=d}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let i=0;const r=this.buf_;let o=this.inbuf_;for(;i<t;){if(o===0)for(;i<=s;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(r[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}else for(;i<t;)if(r[o]=e[i],++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[s]=this.chain_[i]>>r&255,++s;return e}}function Bt(n,e){return`${n} failed: ${e} argument `}const ta=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);if(i>=55296&&i<=56319){const r=i-55296;s++,p(s<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(s)-56320;i=65536+(r<<10)+o}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},$t=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};const na=1e3,sa=2,ia=14400*1e3,ra=.5;function Ds(n,e=na,t=sa){const s=e*Math.pow(t,n),i=Math.round(ra*s*(Math.random()-.5)*2);return Math.min(ia,s+i)}function he(n){return n&&n._delegate?n._delegate:n}class X{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const de="[DEFAULT]";class oa{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new rt;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const s=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(la(e))try{this.getOrInitializeService({instanceIdentifier:de})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=de){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=de){return this.instances.has(e)}getOptions(e=de){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);s===a&&o.resolve(i)}return i}onInit(e,t){var s;const i=this.normalizeInstanceIdentifier(t),r=(s=this.onInitCallbacks.get(i))!==null&&s!==void 0?s:new Set;r.add(e),this.onInitCallbacks.set(i,r);const o=this.instances.get(i);return o&&e(o,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const i of s)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:aa(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=de){return this.component?this.component.multipleInstances?e:de:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function aa(n){return n===de?void 0:n}function la(n){return n.instantiationMode==="EAGER"}class ca{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new oa(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var T;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(T||(T={}));const ua={debug:T.DEBUG,verbose:T.VERBOSE,info:T.INFO,warn:T.WARN,error:T.ERROR,silent:T.SILENT},ha=T.INFO,da={[T.DEBUG]:"log",[T.VERBOSE]:"log",[T.INFO]:"info",[T.WARN]:"warn",[T.ERROR]:"error"},fa=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),i=da[e];if(i)console[i](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ln{constructor(e){this.name=e,this._logLevel=ha,this._logHandler=fa,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in T))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ua[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,T.DEBUG,...e),this._logHandler(this,T.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,T.VERBOSE,...e),this._logHandler(this,T.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,T.INFO,...e),this._logHandler(this,T.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,T.WARN,...e),this._logHandler(this,T.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,T.ERROR,...e),this._logHandler(this,T.ERROR,...e)}}const pa=(n,e)=>e.some(t=>n instanceof t);let xs,Ps;function _a(){return xs||(xs=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ga(){return Ps||(Ps=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const $i=new WeakMap,gn=new WeakMap,Wi=new WeakMap,en=new WeakMap,Fn=new WeakMap;function ma(n){const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{t(ne(n.result)),i()},o=()=>{s(n.error),i()};n.addEventListener("success",r),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&$i.set(t,n)}).catch(()=>{}),Fn.set(e,n),e}function ya(n){if(gn.has(n))return;const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{t(),i()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});gn.set(n,e)}let mn={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return gn.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Wi.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ne(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function va(n){mn=n(mn)}function Ea(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(tn(this),e,...t);return Wi.set(s,e.sort?e.sort():[e]),ne(s)}:ga().includes(n)?function(...e){return n.apply(tn(this),e),ne($i.get(this))}:function(...e){return ne(n.apply(tn(this),e))}}function wa(n){return typeof n=="function"?Ea(n):(n instanceof IDBTransaction&&ya(n),pa(n,_a())?new Proxy(n,mn):n)}function ne(n){if(n instanceof IDBRequest)return ma(n);if(en.has(n))return en.get(n);const e=wa(n);return e!==n&&(en.set(n,e),Fn.set(e,n)),e}const tn=n=>Fn.get(n);function Ui(n,e,{blocked:t,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(n,e),a=ne(o);return s&&o.addEventListener("upgradeneeded",l=>{s(ne(o.result),l.oldVersion,l.newVersion,ne(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const Ca=["get","getKey","getAll","getAllKeys","count"],Ia=["put","add","delete","clear"],nn=new Map;function Os(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(nn.get(e))return nn.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,i=Ia.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(i||Ca.includes(t)))return;const r=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return s&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),i&&l.done]))[0]};return nn.set(e,r),r}va(n=>({...n,get:(e,t,s)=>Os(e,t)||n.get(e,t,s),has:(e,t)=>!!Os(e,t)||n.has(e,t)}));class ba{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Ta(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function Ta(n){const e=n.getComponent();return e?.type==="VERSION"}const yn="@firebase/app",Ms="0.10.13";const J=new Ln("@firebase/app"),Sa="@firebase/app-compat",Na="@firebase/analytics-compat",Aa="@firebase/analytics",Ra="@firebase/app-check-compat",ka="@firebase/app-check",Da="@firebase/auth",xa="@firebase/auth-compat",Pa="@firebase/database",Oa="@firebase/data-connect",Ma="@firebase/database-compat",La="@firebase/functions",Fa="@firebase/functions-compat",Ba="@firebase/installations",$a="@firebase/installations-compat",Wa="@firebase/messaging",Ua="@firebase/messaging-compat",Ha="@firebase/performance",Va="@firebase/performance-compat",qa="@firebase/remote-config",Ga="@firebase/remote-config-compat",ja="@firebase/storage",za="@firebase/storage-compat",Ka="@firebase/firestore",Ya="@firebase/vertexai-preview",Qa="@firebase/firestore-compat",Xa="firebase",Ja="10.14.1";const vn="[DEFAULT]",Za={[yn]:"fire-core",[Sa]:"fire-core-compat",[Aa]:"fire-analytics",[Na]:"fire-analytics-compat",[ka]:"fire-app-check",[Ra]:"fire-app-check-compat",[Da]:"fire-auth",[xa]:"fire-auth-compat",[Pa]:"fire-rtdb",[Oa]:"fire-data-connect",[Ma]:"fire-rtdb-compat",[La]:"fire-fn",[Fa]:"fire-fn-compat",[Ba]:"fire-iid",[$a]:"fire-iid-compat",[Wa]:"fire-fcm",[Ua]:"fire-fcm-compat",[Ha]:"fire-perf",[Va]:"fire-perf-compat",[qa]:"fire-rc",[Ga]:"fire-rc-compat",[ja]:"fire-gcs",[za]:"fire-gcs-compat",[Ka]:"fire-fst",[Qa]:"fire-fst-compat",[Ya]:"fire-vertex","fire-js":"fire-js",[Xa]:"fire-js-all"};const Ct=new Map,el=new Map,En=new Map;function Ls(n,e){try{n.container.addComponent(e)}catch(t){J.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function oe(n){const e=n.name;if(En.has(e))return J.debug(`There were multiple attempts to register component ${e}.`),!1;En.set(e,n);for(const t of Ct.values())Ls(t,n);for(const t of el.values())Ls(t,n);return!0}function ot(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}const tl={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},se=new Ft("app","Firebase",tl);class nl{constructor(e,t,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new X("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw se.create("app-deleted",{appName:this._name})}}const sl=Ja;function Hi(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s=Object.assign({name:vn,automaticDataCollectionEnabled:!1},e),i=s.name;if(typeof i!="string"||!i)throw se.create("bad-app-name",{appName:String(i)});if(t||(t=Oi()),!t)throw se.create("no-options");const r=Ct.get(i);if(r){if(wt(t,r.options)&&wt(s,r.config))return r;throw se.create("duplicate-app",{appName:i})}const o=new ca(i);for(const l of En.values())o.addComponent(l);const a=new nl(t,s,o);return Ct.set(i,a),a}function Vi(n=vn){const e=Ct.get(n);if(!e&&n===vn&&Oi())return Hi();if(!e)throw se.create("no-app",{appName:n});return e}function j(n,e,t){var s;let i=(s=Za[n])!==null&&s!==void 0?s:n;t&&(i+=`-${t}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${i}" with version "${e}":`];r&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),J.warn(a.join(" "));return}oe(new X(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const il="firebase-heartbeat-database",rl=1,Qe="firebase-heartbeat-store";let sn=null;function qi(){return sn||(sn=Ui(il,rl,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Qe)}catch(t){console.warn(t)}}}}).catch(n=>{throw se.create("idb-open",{originalErrorMessage:n.message})})),sn}async function ol(n){try{const t=(await qi()).transaction(Qe),s=await t.objectStore(Qe).get(Gi(n));return await t.done,s}catch(e){if(e instanceof we)J.warn(e.message);else{const t=se.create("idb-get",{originalErrorMessage:e?.message});J.warn(t.message)}}}async function Fs(n,e){try{const s=(await qi()).transaction(Qe,"readwrite");await s.objectStore(Qe).put(e,Gi(n)),await s.done}catch(t){if(t instanceof we)J.warn(t.message);else{const s=se.create("idb-set",{originalErrorMessage:t?.message});J.warn(s.message)}}}function Gi(n){return`${n.name}!${n.options.appId}`}const al=1024,ll=720*60*60*1e3;class cl{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new hl(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Bs();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r)?void 0:(this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=ll}),this._storage.overwrite(this._heartbeatsCache))}catch(s){J.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Bs(),{heartbeatsToSend:s,unsentEntries:i}=ul(this._heartbeatsCache.heartbeats),r=vt(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(t){return J.warn(t),""}}}function Bs(){return new Date().toISOString().substring(0,10)}function ul(n,e=al){const t=[];let s=n.slice();for(const i of n){const r=t.find(o=>o.agent===i.agent);if(r){if(r.dates.push(i.date),$s(t)>e){r.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),$s(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class hl{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Li()?Fi().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await ol(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Fs(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Fs(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function $s(n){return vt(JSON.stringify({version:2,heartbeats:n})).length}function dl(n){oe(new X("platform-logger",e=>new ba(e),"PRIVATE")),oe(new X("heartbeat",e=>new cl(e),"PRIVATE")),j(yn,Ms,n),j(yn,Ms,"esm2017"),j("fire-js","")}dl("");var fl="firebase",pl="10.14.1";j(fl,pl,"app");const ji="@firebase/installations",Bn="0.6.9";const zi=1e4,Ki=`w:${Bn}`,Yi="FIS_v2",_l="https://firebaseinstallations.googleapis.com/v1",gl=3600*1e3,ml="installations",yl="Installations";const vl={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},ge=new Ft(ml,yl,vl);function Qi(n){return n instanceof we&&n.code.includes("request-failed")}function Xi({projectId:n}){return`${_l}/projects/${n}/installations`}function Ji(n){return{token:n.token,requestStatus:2,expiresIn:wl(n.expiresIn),creationTime:Date.now()}}async function Zi(n,e){const s=(await e.json()).error;return ge.create("request-failed",{requestName:n,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function er({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function El(n,{refreshToken:e}){const t=er(n);return t.append("Authorization",Cl(e)),t}async function tr(n){const e=await n();return e.status>=500&&e.status<600?n():e}function wl(n){return Number(n.replace("s","000"))}function Cl(n){return`${Yi} ${n}`}async function Il({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const s=Xi(n),i=er(n),r=e.getImmediate({optional:!0});if(r){const c=await r.getHeartbeatsHeader();c&&i.append("x-firebase-client",c)}const o={fid:t,authVersion:Yi,appId:n.appId,sdkVersion:Ki},a={method:"POST",headers:i,body:JSON.stringify(o)},l=await tr(()=>fetch(s,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:Ji(c.authToken)}}else throw await Zi("Create Installation",l)}function nr(n){return new Promise(e=>{setTimeout(e,n)})}function bl(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}const Tl=/^[cdef][\w-]{21}$/,wn="";function Sl(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=Nl(n);return Tl.test(t)?t:wn}catch{return wn}}function Nl(n){return bl(n).substr(0,22)}function Wt(n){return`${n.appName}!${n.appId}`}const sr=new Map;function ir(n,e){const t=Wt(n);rr(t,e),Al(t,e)}function rr(n,e){const t=sr.get(n);if(t)for(const s of t)s(e)}function Al(n,e){const t=Rl();t&&t.postMessage({key:n,fid:e}),kl()}let pe=null;function Rl(){return!pe&&"BroadcastChannel"in self&&(pe=new BroadcastChannel("[Firebase] FID Change"),pe.onmessage=n=>{rr(n.data.key,n.data.fid)}),pe}function kl(){sr.size===0&&pe&&(pe.close(),pe=null)}const Dl="firebase-installations-database",xl=1,me="firebase-installations-store";let rn=null;function $n(){return rn||(rn=Ui(Dl,xl,{upgrade:(n,e)=>{e===0&&n.createObjectStore(me)}})),rn}async function It(n,e){const t=Wt(n),i=(await $n()).transaction(me,"readwrite"),r=i.objectStore(me),o=await r.get(t);return await r.put(e,t),await i.done,(!o||o.fid!==e.fid)&&ir(n,e.fid),e}async function or(n){const e=Wt(n),s=(await $n()).transaction(me,"readwrite");await s.objectStore(me).delete(e),await s.done}async function Ut(n,e){const t=Wt(n),i=(await $n()).transaction(me,"readwrite"),r=i.objectStore(me),o=await r.get(t),a=e(o);return a===void 0?await r.delete(t):await r.put(a,t),await i.done,a&&(!o||o.fid!==a.fid)&&ir(n,a.fid),a}async function Wn(n){let e;const t=await Ut(n.appConfig,s=>{const i=Pl(s),r=Ol(n,i);return e=r.registrationPromise,r.installationEntry});return t.fid===wn?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function Pl(n){const e=n||{fid:Sl(),registrationStatus:0};return ar(e)}function Ol(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const i=Promise.reject(ge.create("app-offline"));return{installationEntry:e,registrationPromise:i}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=Ml(n,t);return{installationEntry:t,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Ll(n)}:{installationEntry:e}}async function Ml(n,e){try{const t=await Il(n,e);return It(n.appConfig,t)}catch(t){throw Qi(t)&&t.customData.serverCode===409?await or(n.appConfig):await It(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function Ll(n){let e=await Ws(n.appConfig);for(;e.registrationStatus===1;)await nr(100),e=await Ws(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:s}=await Wn(n);return s||t}return e}function Ws(n){return Ut(n,e=>{if(!e)throw ge.create("installation-not-found");return ar(e)})}function ar(n){return Fl(n)?{fid:n.fid,registrationStatus:0}:n}function Fl(n){return n.registrationStatus===1&&n.registrationTime+zi<Date.now()}async function Bl({appConfig:n,heartbeatServiceProvider:e},t){const s=$l(n,t),i=El(n,t),r=e.getImmediate({optional:!0});if(r){const c=await r.getHeartbeatsHeader();c&&i.append("x-firebase-client",c)}const o={installation:{sdkVersion:Ki,appId:n.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},l=await tr(()=>fetch(s,a));if(l.ok){const c=await l.json();return Ji(c)}else throw await Zi("Generate Auth Token",l)}function $l(n,{fid:e}){return`${Xi(n)}/${e}/authTokens:generate`}async function Un(n,e=!1){let t;const s=await Ut(n.appConfig,r=>{if(!lr(r))throw ge.create("not-registered");const o=r.authToken;if(!e&&Hl(o))return r;if(o.requestStatus===1)return t=Wl(n,e),r;{if(!navigator.onLine)throw ge.create("app-offline");const a=ql(r);return t=Ul(n,a),a}});return t?await t:s.authToken}async function Wl(n,e){let t=await Us(n.appConfig);for(;t.authToken.requestStatus===1;)await nr(100),t=await Us(n.appConfig);const s=t.authToken;return s.requestStatus===0?Un(n,e):s}function Us(n){return Ut(n,e=>{if(!lr(e))throw ge.create("not-registered");const t=e.authToken;return Gl(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function Ul(n,e){try{const t=await Bl(n,e),s=Object.assign(Object.assign({},e),{authToken:t});return await It(n.appConfig,s),t}catch(t){if(Qi(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await or(n.appConfig);else{const s=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await It(n.appConfig,s)}throw t}}function lr(n){return n!==void 0&&n.registrationStatus===2}function Hl(n){return n.requestStatus===2&&!Vl(n)}function Vl(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+gl}function ql(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function Gl(n){return n.requestStatus===1&&n.requestTime+zi<Date.now()}async function jl(n){const e=n,{installationEntry:t,registrationPromise:s}=await Wn(e);return s?s.catch(console.error):Un(e).catch(console.error),t.fid}async function zl(n,e=!1){const t=n;return await Kl(t),(await Un(t,e)).token}async function Kl(n){const{registrationPromise:e}=await Wn(n);e&&await e}function Yl(n){if(!n||!n.options)throw on("App Configuration");if(!n.name)throw on("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw on(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function on(n){return ge.create("missing-app-config-values",{valueName:n})}const cr="installations",Ql="installations-internal",Xl=n=>{const e=n.getProvider("app").getImmediate(),t=Yl(e),s=ot(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},Jl=n=>{const e=n.getProvider("app").getImmediate(),t=ot(e,cr).getImmediate();return{getId:()=>jl(t),getToken:i=>zl(t,i)}};function Zl(){oe(new X(cr,Xl,"PUBLIC")),oe(new X(Ql,Jl,"PRIVATE"))}Zl();j(ji,Bn);j(ji,Bn,"esm2017");const bt="analytics",ec="firebase_id",tc="origin",nc=60*1e3,sc="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Hn="https://www.googletagmanager.com/gtag/js";const $=new Ln("@firebase/analytics");const ic={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},W=new Ft("analytics","Analytics",ic);function rc(n){if(!n.startsWith(Hn)){const e=W.create("invalid-gtag-resource",{gtagURL:n});return $.warn(e.message),""}return n}function ur(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function oc(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function ac(n,e){const t=oc("firebase-js-sdk-policy",{createScriptURL:rc}),s=document.createElement("script"),i=`${Hn}?l=${n}&id=${e}`;s.src=t?t?.createScriptURL(i):i,s.async=!0,document.head.appendChild(s)}function lc(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function cc(n,e,t,s,i,r){const o=s[i];try{if(o)await e[o];else{const l=(await ur(t)).find(c=>c.measurementId===i);l&&await e[l.appId]}}catch(a){$.error(a)}n("config",i,r)}async function uc(n,e,t,s,i){try{let r=[];if(i&&i.send_to){let o=i.send_to;Array.isArray(o)||(o=[o]);const a=await ur(t);for(const l of o){const c=a.find(u=>u.measurementId===l),h=c&&e[c.appId];if(h)r.push(h);else{r=[];break}}}r.length===0&&(r=Object.values(e)),await Promise.all(r),n("event",s,i||{})}catch(r){$.error(r)}}function hc(n,e,t,s){async function i(r,...o){try{if(r==="event"){const[a,l]=o;await uc(n,e,t,a,l)}else if(r==="config"){const[a,l]=o;await cc(n,e,t,s,a,l)}else if(r==="consent"){const[a,l]=o;n("consent",a,l)}else if(r==="get"){const[a,l,c]=o;n("get",a,l,c)}else if(r==="set"){const[a]=o;n("set",a)}else n(r,...o)}catch(a){$.error(a)}}return i}function dc(n,e,t,s,i){let r=function(...o){window[s].push(arguments)};return window[i]&&typeof window[i]=="function"&&(r=window[i]),window[i]=hc(r,n,e,t),{gtagCore:r,wrappedGtag:window[i]}}function fc(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Hn)&&t.src.includes(n))return t;return null}const pc=30,_c=1e3;class gc{constructor(e={},t=_c){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const hr=new gc;function mc(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function yc(n){var e;const{appId:t,apiKey:s}=n,i={method:"GET",headers:mc(s)},r=sc.replace("{app-id}",t),o=await fetch(r,i);if(o.status!==200&&o.status!==304){let a="";try{const l=await o.json();!((e=l.error)===null||e===void 0)&&e.message&&(a=l.error.message)}catch{}throw W.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function vc(n,e=hr,t){const{appId:s,apiKey:i,measurementId:r}=n.options;if(!s)throw W.create("no-app-id");if(!i){if(r)return{measurementId:r,appId:s};throw W.create("no-api-key")}const o=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Cc;return setTimeout(async()=>{a.abort()},nc),dr({appId:s,apiKey:i,measurementId:r},o,a,e)}async function dr(n,{throttleEndTimeMillis:e,backoffCount:t},s,i=hr){var r;const{appId:o,measurementId:a}=n;try{await Ec(s,e)}catch(l){if(a)return $.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l?.message}]`),{appId:o,measurementId:a};throw l}try{const l=await yc(n);return i.deleteThrottleMetadata(o),l}catch(l){const c=l;if(!wc(c)){if(i.deleteThrottleMetadata(o),a)return $.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c?.message}]`),{appId:o,measurementId:a};throw l}const h=Number((r=c?.customData)===null||r===void 0?void 0:r.httpStatus)===503?Ds(t,i.intervalMillis,pc):Ds(t,i.intervalMillis),u={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return i.setThrottleMetadata(o,u),$.debug(`Calling attemptFetch again in ${h} millis`),dr(n,u,s,i)}}function Ec(n,e){return new Promise((t,s)=>{const i=Math.max(e-Date.now(),0),r=setTimeout(t,i);n.addEventListener(()=>{clearTimeout(r),s(W.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function wc(n){if(!(n instanceof we)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class Cc{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Ic(n,e,t,s,i){if(i&&i.global){n("event",t,s);return}else{const r=await e,o=Object.assign(Object.assign({},s),{send_to:r});n("event",t,o)}}async function bc(){if(Li())try{await Fi()}catch(n){return $.warn(W.create("indexeddb-unavailable",{errorInfo:n?.toString()}).message),!1}else return $.warn(W.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Tc(n,e,t,s,i,r,o){var a;const l=vc(n);l.then(f=>{t[f.measurementId]=f.appId,n.options.measurementId&&f.measurementId!==n.options.measurementId&&$.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${f.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(f=>$.error(f)),e.push(l);const c=bc().then(f=>{if(f)return s.getId()}),[h,u]=await Promise.all([l,c]);fc(r)||ac(r,h.measurementId),i("js",new Date);const d=(a=o?.config)!==null&&a!==void 0?a:{};return d[tc]="firebase",d.update=!0,u!=null&&(d[ec]=u),i("config",h.measurementId,d),h.measurementId}class Sc{constructor(e){this.app=e}_delete(){return delete Ve[this.app.options.appId],Promise.resolve()}}let Ve={},Hs=[];const Vs={};let an="dataLayer",Nc="gtag",qs,fr,Gs=!1;function Ac(){const n=[];if(qo()&&n.push("This is a browser extension environment."),zo()||n.push("Cookies are not available."),n.length>0){const e=n.map((s,i)=>`(${i+1}) ${s}`).join(" "),t=W.create("invalid-analytics-context",{errorInfo:e});$.warn(t.message)}}function Rc(n,e,t){Ac();const s=n.options.appId;if(!s)throw W.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)$.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw W.create("no-api-key");if(Ve[s]!=null)throw W.create("already-exists",{id:s});if(!Gs){lc(an);const{wrappedGtag:r,gtagCore:o}=dc(Ve,Hs,Vs,an,Nc);fr=r,qs=o,Gs=!0}return Ve[s]=Tc(n,Hs,Vs,e,qs,an,t),new Sc(n)}function kc(n=Vi()){n=he(n);const e=ot(n,bt);return e.isInitialized()?e.getImmediate():Dc(n)}function Dc(n,e={}){const t=ot(n,bt);if(t.isInitialized()){const i=t.getImmediate();if(wt(e,t.getOptions()))return i;throw W.create("already-initialized")}return t.initialize({options:e})}function xc(n,e,t,s){n=he(n),Ic(fr,Ve[n.app.options.appId],e,t,s).catch(i=>$.error(i))}const js="@firebase/analytics",zs="0.10.8";function Pc(){oe(new X(bt,(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return Rc(s,i,t)},"PUBLIC")),oe(new X("analytics-internal",n,"PRIVATE")),j(js,zs),j(js,zs,"esm2017");function n(e){try{const t=e.getProvider(bt).getImmediate();return{logEvent:(s,i,r)=>xc(t,s,i,r)}}catch(t){throw W.create("interop-component-reg-failed",{reason:t})}}}Pc();var Ks={};const Ys="@firebase/database",Qs="1.0.8";let pr="";function Oc(n){pr=n}class Mc{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),k(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Ye(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Lc{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return K(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const _r=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Mc(e)}}catch{}return new Lc},_e=_r("localStorage"),Fc=_r("sessionStorage");const Ne=new Ln("@firebase/database"),Bc=(function(){let n=1;return function(){return n++}})(),gr=function(n){const e=ta(n),t=new ea;t.update(e);const s=t.digest();return Mn.encodeByteArray(s)},at=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=at.apply(null,s):typeof s=="object"?e+=k(s):e+=s,e+=" "}return e};let qe=null,Xs=!0;const $c=function(n,e){p(!0,"Can't turn on custom loggers persistently."),Ne.logLevel=T.VERBOSE,qe=Ne.log.bind(Ne)},P=function(...n){if(Xs===!0&&(Xs=!1,qe===null&&Fc.get("logging_enabled")===!0&&$c()),qe){const e=at.apply(null,n);qe(e)}},lt=function(n){return function(...e){P(n,...e)}},Cn=function(...n){const e="FIREBASE INTERNAL ERROR: "+at(...n);Ne.error(e)},Z=function(...n){const e=`FIREBASE FATAL ERROR: ${at(...n)}`;throw Ne.error(e),new Error(e)},F=function(...n){const e="FIREBASE WARNING: "+at(...n);Ne.warn(e)},Wc=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&F("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Vn=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Uc=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},ke="[MIN_NAME]",ye="[MAX_NAME]",Ce=function(n,e){if(n===e)return 0;if(n===ke||e===ye)return-1;if(e===ke||n===ye)return 1;{const t=Js(n),s=Js(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},Hc=function(n,e){return n===e?0:n<e?-1:1},$e=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+k(e))},qn=function(n){if(typeof n!="object"||n===null)return k(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=k(e[s]),t+=":",t+=qn(n[e[s]]);return t+="}",t},mr=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let i=0;i<t;i+=e)i+e>t?s.push(n.substring(i,t)):s.push(n.substring(i,i+e));return s};function O(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const yr=function(n){p(!Vn(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let i,r,o,a,l;n===0?(r=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),s),r=a+s,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-s-t))));const c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(i?1:0),c.reverse();const h=c.join("");let u="";for(l=0;l<64;l+=8){let d=parseInt(h.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),u=u+d}return u.toLowerCase()},Vc=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},qc=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Gc(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}const jc=new RegExp("^-?(0*)\\d{1,10}$"),zc=-2147483648,Kc=2147483647,Js=function(n){if(jc.test(n)){const e=Number(n);if(e>=zc&&e<=Kc)return e}return null},Le=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw F("Exception was thrown by user callback.",t),e},Math.floor(0))}},Yc=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ge=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class Qc{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){F(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Xc{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(P("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',F(e)}}class yt{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}yt.OWNER="owner";const Gn="5",vr="v",Er="s",wr="r",Cr="f",Ir=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,br="ls",Tr="p",In="ac",Sr="websocket",Nr="long_polling";class Ar{constructor(e,t,s,i,r=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=_e.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&_e.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Jc(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function Rr(n,e,t){p(typeof e=="string","typeof type must == string"),p(typeof t=="object","typeof params must == object");let s;if(e===Sr)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Nr)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Jc(n)&&(t.ns=n.namespace);const i=[];return O(t,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}class Zc{constructor(){this.counters_={}}incrementCounter(e,t=1){K(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Oo(this.counters_)}}const ln={},cn={};function jn(n){const e=n.toString();return ln[e]||(ln[e]=new Zc),ln[e]}function eu(n,e){const t=n.toString();return cn[t]||(cn[t]=e()),cn[t]}class tu{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&Le(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Zs="start",nu="close",su="pLPCommand",iu="pRTLPCB",kr="id",Dr="pw",xr="ser",ru="cb",ou="seg",au="ts",lu="d",cu="dframe",Pr=1870,Or=30,uu=Pr-Or,hu=25e3,du=3e4;class Se{constructor(e,t,s,i,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=lt(e),this.stats_=jn(t),this.urlFn=l=>(this.appCheckToken&&(l[In]=this.appCheckToken),Rr(t,Nr,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new tu(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(du)),Uc(()=>{if(this.isClosed_)return;this.scriptTagHolder=new zn((...r)=>{const[o,a,l,c,h]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Zs)this.id=a,this.password=l;else if(o===nu)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={};s[Zs]="t",s[xr]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[ru]=this.scriptTagHolder.uniqueCallbackIdentifier),s[vr]=Gn,this.transportSessionId&&(s[Er]=this.transportSessionId),this.lastSessionId&&(s[br]=this.lastSessionId),this.applicationId&&(s[Tr]=this.applicationId),this.appCheckToken&&(s[In]=this.appCheckToken),typeof location<"u"&&location.hostname&&Ir.test(location.hostname)&&(s[wr]=Cr);const i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Se.forceAllow_=!0}static forceDisallow(){Se.forceDisallow_=!0}static isAvailable(){return Se.forceAllow_?!0:!Se.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Vc()&&!qc()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=k(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=Di(t),i=mr(s,uu);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[cu]="t",s[kr]=e,s[Dr]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=k(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class zn{constructor(e,t,s,i){this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Bc(),window[su+this.uniqueCallbackIdentifier]=e,window[iu+this.uniqueCallbackIdentifier]=t,this.myIFrame=zn.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){P("frame writing exception"),a.stack&&P(a.stack),P(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||P("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[kr]=this.myID,e[Dr]=this.myPW,e[xr]=this.currentSerial;let t=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Or+s.length<=Pr;){const o=this.pendingSegs.shift();s=s+"&"+ou+i+"="+o.seg+"&"+au+i+"="+o.ts+"&"+lu+i+"="+o.d,i++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(s,Math.floor(hu)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{P("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}const fu=16384,pu=45e3;let Tt=null;typeof MozWebSocket<"u"?Tt=MozWebSocket:typeof WebSocket<"u"&&(Tt=WebSocket);class V{constructor(e,t,s,i,r,o,a){this.connId=e,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=lt(this.connId),this.stats_=jn(t),this.connURL=V.connectionURL_(t,o,a,i,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,i,r){const o={};return o[vr]=Gn,typeof location<"u"&&location.hostname&&Ir.test(location.hostname)&&(o[wr]=Cr),t&&(o[Er]=t),s&&(o[br]=s),i&&(o[In]=i),r&&(o[Tr]=r),Rr(e,Sr,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,_e.set("previous_websocket_failure",!0);try{let s;jo(),this.mySock=new Tt(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){V.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&Tt!==null&&!V.forceDisallow_}static previouslyFailed(){return _e.isInMemoryStorage||_e.get("previous_websocket_failure")===!0}markConnectionHealthy(){_e.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=Ye(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(p(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=k(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=mr(t,fu);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(pu))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}V.responsesRequiredToBeHealthy=2;V.healthyTimeout=3e4;class Xe{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Se,V]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=V&&V.isAvailable();let s=t&&!V.previouslyFailed();if(e.webSocketOnly&&(t||F("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[V];else{const i=this.transports_=[];for(const r of Xe.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r);Xe.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Xe.globalTransportInitialized_=!1;const _u=6e4,gu=5e3,mu=10*1024,yu=100*1024,un="t",ei="d",vu="s",ti="r",Eu="e",ni="o",si="a",ii="n",ri="p",wu="h";class Cu{constructor(e,t,s,i,r,o,a,l,c,h){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=lt("c:"+this.id+":"),this.transportManager_=new Xe(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Ge(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>yu?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>mu?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(un in e){const t=e[un];t===si?this.upgradeIfSecondaryHealthy_():t===ti?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===ni&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=$e("t",e),s=$e("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:ri,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:si,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:ii,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=$e("t",e),s=$e("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=$e(un,e);if(ei in e){const s=e[ei];if(t===wu){const i=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===ii){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===vu?this.onConnectionShutdown_(s):t===ti?this.onReset_(s):t===Eu?Cn("Server Error: "+s):t===ni?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Cn("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Gn!==s&&F("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),Ge(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(_u))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ge(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(gu))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:ri,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(_e.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Mr{put(e,t,s,i){}merge(e,t,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}class Lr{constructor(e){this.allowedEvents_=e,this.listeners_={},p(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const i=this.getInitialEvent(e);i&&t.apply(s,i)}off(e,t,s){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){p(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class St extends Lr{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Mi()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new St}getInitialEvent(e){return p(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const oi=32,ai=768;class C{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function w(){return new C("")}function v(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ae(n){return n.pieces_.length-n.pieceNum_}function S(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new C(n.pieces_,e)}function Kn(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Iu(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Je(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Fr(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new C(e,0)}function N(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof C)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&t.push(s[i])}return new C(t,0)}function y(n){return n.pieceNum_>=n.pieces_.length}function L(n,e){const t=v(n),s=v(e);if(t===null)return e;if(t===s)return L(S(n),S(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function bu(n,e){const t=Je(n,0),s=Je(e,0);for(let i=0;i<t.length&&i<s.length;i++){const r=Ce(t[i],s[i]);if(r!==0)return r}return t.length===s.length?0:t.length<s.length?-1:1}function Br(n,e){if(ae(n)!==ae(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function U(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(ae(n)>ae(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class Tu{constructor(e,t){this.errorPrefix_=t,this.parts_=Je(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=$t(this.parts_[s]);$r(this)}}function Su(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=$t(e),$r(n)}function Nu(n){const e=n.parts_.pop();n.byteLength_-=$t(e),n.parts_.length>0&&(n.byteLength_-=1)}function $r(n){if(n.byteLength_>ai)throw new Error(n.errorPrefix_+"has a key path longer than "+ai+" bytes ("+n.byteLength_+").");if(n.parts_.length>oi)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+oi+") or object contains a cycle "+fe(n))}function fe(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class Yn extends Lr{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}static getInstance(){return new Yn}getInitialEvent(e){return p(e==="visible","Unknown event type: "+e),[this.visible_]}}const We=1e3,Au=300*1e3,li=30*1e3,Ru=1.3,ku=3e4,Du="server_kill",ci=3;class Q extends Mr{constructor(e,t,s,i,r,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Q.nextPersistentConnectionId_++,this.log_=lt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=We,this.maxReconnectDelay_=Au,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Yn.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&St.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(k(r)),p(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),s&&(this.requestCBHash_[i]=s)}get(e){this.initConnection_();const t=new rt,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,s,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),p(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),p(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:t,query:e,tag:s};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+s+" for "+i);const r={p:s},o="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{const l=a.d,c=a.s;Q.warnOnListenWarnings_(l,t),(this.listens.get(s)&&this.listens.get(s).get(i))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(s,i),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&K(e,"w")){const s=Re(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();F(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Jo(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=li)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Xo(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,i=>{const r=i.s,o=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),p(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,e._queryObject,t)}sendUnlisten_(e,t,s,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e},o="n";i&&(r.q=s,r.t=i),this.sendRequest(o,r)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,i){const r={p:t,d:s};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,t,s,i){this.putInternal("p",e,t,s,i)}merge(e,t,s,i){this.putInternal("m",e,t,s,i)}putInternal(e,t,s,i,r){this.initConnection_();const o={p:t,d:s};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const r=s.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+k(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Cn("Unrecognized action received from server: "+k(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){p(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=We,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=We,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>ku&&(this.reconnectDelay_=We),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Ru)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Q.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,s())},c=function(u){p(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(u)};this.realtime_={close:l,sendRequest:c};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[u,d]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?P("getToken() completed but was canceled"):(P("getToken() completed. Creating connection."),this.authToken_=u&&u.accessToken,this.appCheckToken_=d&&d.token,a=new Cu(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,f=>{F(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(Du)},r))}catch(u){this.log_("Failed to get token: "+u),o||(this.repoInfo_.nodeAdmin&&F(u),l())}}}interrupt(e){P("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){P("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Rs(this.interruptReasons_)&&(this.reconnectDelay_=We,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(r=>qn(r)).join("$"):s="default";const i=this.removeListen_(e,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const s=new C(e).toString();let i;if(this.listens.has(s)){const r=this.listens.get(s);i=r.get(t),r.delete(t),r.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(e,t){P("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=ci&&(this.reconnectDelay_=li,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){P("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=ci&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+pr.replace(/\./g,"-")]=1,Mi()?e["framework.cordova"]=1:Go()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=St.getInstance().currentlyOnline();return Rs(this.interruptReasons_)&&e}}Q.nextPersistentConnectionId_=0;Q.nextConnectionId_=0;class m{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new m(e,t)}}class Ht{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new m(ke,e),i=new m(ke,t);return this.compare(s,i)!==0}minPost(){return m.MIN}}let gt;class Wr extends Ht{static get __EMPTY_NODE(){return gt}static set __EMPTY_NODE(e){gt=e}compare(e,t){return Ce(e.name,t.name)}isDefinedOn(e){throw Me("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return m.MIN}maxPost(){return new m(ye,gt)}makePost(e,t){return p(typeof e=="string","KeyIndex indexValue must always be a string."),new m(e,gt)}toString(){return".key"}}const Ae=new Wr;class mt{constructor(e,t,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class x{constructor(e,t,s,i,r){this.key=e,this.value=t,this.color=s??x.RED,this.left=i??B.EMPTY_NODE,this.right=r??B.EMPTY_NODE}copy(e,t,s,i,r){return new x(e??this.key,t??this.value,s??this.color,i??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let i=this;const r=s(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,t,s),null):r===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return B.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,i;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return B.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,x.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,x.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}x.RED=!0;x.BLACK=!1;class xu{copy(e,t,s,i,r){return this}insert(e,t,s){return new x(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class B{constructor(e,t=B.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new B(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,x.BLACK,null,null))}remove(e){return new B(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,x.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,i=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new mt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new mt(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new mt(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new mt(this.root_,null,this.comparator_,!0,e)}}B.EMPTY_NODE=new xu;function Pu(n,e){return Ce(n.name,e.name)}function Qn(n,e){return Ce(n,e)}let bn;function Ou(n){bn=n}const Ur=function(n){return typeof n=="number"?"number:"+yr(n):"string:"+n},Hr=function(n){if(n.isLeafNode()){const e=n.val();p(typeof e=="string"||typeof e=="number"||typeof e=="object"&&K(e,".sv"),"Priority must be a string or number.")}else p(n===bn||n.isEmpty(),"priority of unexpected type.");p(n===bn||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let ui;class D{constructor(e,t=D.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,p(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Hr(this.priorityNode_)}static set __childrenNodeConstructor(e){ui=e}static get __childrenNodeConstructor(){return ui}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new D(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:D.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return y(e)?this:v(e)===".priority"?this.priorityNode_:D.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:D.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=v(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(p(s!==".priority"||ae(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,D.__childrenNodeConstructor.EMPTY_NODE.updateChild(S(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Ur(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=yr(this.value_):e+=this.value_,this.lazyHash_=gr(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===D.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof D.__childrenNodeConstructor?-1:(p(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,i=D.VALUE_TYPE_ORDER.indexOf(t),r=D.VALUE_TYPE_ORDER.indexOf(s);return p(i>=0,"Unknown leaf type: "+t),p(r>=0,"Unknown leaf type: "+s),i===r?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}D.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Vr,qr;function Mu(n){Vr=n}function Lu(n){qr=n}class Fu extends Ht{compare(e,t){const s=e.node.getPriority(),i=t.node.getPriority(),r=s.compareTo(i);return r===0?Ce(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return m.MIN}maxPost(){return new m(ye,new D("[PRIORITY-POST]",qr))}makePost(e,t){const s=Vr(e);return new m(t,new D("[PRIORITY-POST]",s))}toString(){return".priority"}}const A=new Fu;const Bu=Math.log(2);class $u{constructor(e){const t=r=>parseInt(Math.log(r)/Bu,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Nt=function(n,e,t,s){n.sort(e);const i=function(l,c){const h=c-l;let u,d;if(h===0)return null;if(h===1)return u=n[l],d=t?t(u):u,new x(d,u.node,x.BLACK,null,null);{const f=parseInt(h/2,10)+l,_=i(l,f),I=i(f+1,c);return u=n[f],d=t?t(u):u,new x(d,u.node,x.BLACK,_,I)}},r=function(l){let c=null,h=null,u=n.length;const d=function(_,I){const M=u-_,be=u;u-=_;const _t=i(M+1,be),Zt=n[M],Do=t?t(Zt):Zt;f(new x(Do,Zt.node,I,null,_t))},f=function(_){c?(c.left=_,c=_):(h=_,c=_)};for(let _=0;_<l.count;++_){const I=l.nextBitIsOne(),M=Math.pow(2,l.count-(_+1));I?d(M,x.BLACK):(d(M,x.BLACK),d(M,x.RED))}return h},o=new $u(n.length),a=r(o);return new B(s||e,a)};let hn;const Te={};class Y{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return p(Te&&A,"ChildrenNode.ts has not been loaded"),hn=hn||new Y({".priority":Te},{".priority":A}),hn}get(e){const t=Re(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof B?t:null}hasIndex(e){return K(this.indexSet_,e.toString())}addIndex(e,t){p(e!==Ae,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const r=t.getIterator(m.Wrap);let o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let a;i?a=Nt(s,e.getCompare()):a=Te;const l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;const h=Object.assign({},this.indexes_);return h[l]=a,new Y(h,c)}addToIndexes(e,t){const s=Et(this.indexes_,(i,r)=>{const o=Re(this.indexSet_,r);if(p(o,"Missing index implementation for "+r),i===Te)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(m.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),Nt(a,o.getCompare())}else return Te;else{const a=t.get(e.name);let l=i;return a&&(l=l.remove(new m(e.name,a))),l.insert(e,e.node)}});return new Y(s,this.indexSet_)}removeFromIndexes(e,t){const s=Et(this.indexes_,i=>{if(i===Te)return i;{const r=t.get(e.name);return r?i.remove(new m(e.name,r)):i}});return new Y(s,this.indexSet_)}}let Ue;class g{constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&Hr(this.priorityNode_),this.children_.isEmpty()&&p(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Ue||(Ue=new g(new B(Qn),null,Y.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ue}updatePriority(e){return this.children_.isEmpty()?this:new g(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Ue:t}}getChild(e){const t=v(e);return t===null?this:this.getImmediateChild(t).getChild(S(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(p(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new m(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(s,this.children_));const o=i.isEmpty()?Ue:this.priorityNode_;return new g(i,o,r)}}updateChild(e,t){const s=v(e);if(s===null)return t;{p(v(e)!==".priority"||ae(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(S(e),t);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,i=0,r=!0;if(this.forEachChild(A,(o,a)=>{t[o]=a.val(e),s++,r&&g.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):r=!1}),!e&&r&&i<2*s){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Ur(this.getPriority().val())+":"),this.forEachChild(A,(t,s)=>{const i=s.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":gr(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const i=this.resolveIndex_(s);if(i){const r=i.getPredecessorKey(new m(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new m(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new m(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,m.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,m.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ct?-1:0}withIndex(e){if(e===Ae||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new g(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Ae||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(A),i=t.getIterator(A);let r=s.getNext(),o=i.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=s.getNext(),o=i.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Ae?null:this.indexMap_.get(e.toString())}}g.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Wu extends g{constructor(){super(new B(Qn),g.EMPTY_NODE,Y.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return g.EMPTY_NODE}isEmpty(){return!1}}const ct=new Wu;Object.defineProperties(m,{MIN:{value:new m(ke,g.EMPTY_NODE)},MAX:{value:new m(ye,ct)}});Wr.__EMPTY_NODE=g.EMPTY_NODE;D.__childrenNodeConstructor=g;Ou(ct);Lu(ct);const Uu=!0;function R(n,e=null){if(n===null)return g.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),p(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new D(t,R(e))}if(!(n instanceof Array)&&Uu){const t=[];let s=!1;if(O(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=R(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),t.push(new m(o,l)))}}),t.length===0)return g.EMPTY_NODE;const r=Nt(t,Pu,o=>o.name,Qn);if(s){const o=Nt(t,A.getCompare());return new g(r,R(e),new Y({".priority":o},{".priority":A}))}else return new g(r,R(e),Y.Default)}else{let t=g.EMPTY_NODE;return O(n,(s,i)=>{if(K(n,s)&&s.substring(0,1)!=="."){const r=R(i);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(s,r))}}),t.updatePriority(R(e))}}Mu(R);class Hu extends Ht{constructor(e){super(),this.indexPath_=e,p(!y(e)&&v(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),i=this.extractChild(t.node),r=s.compareTo(i);return r===0?Ce(e.name,t.name):r}makePost(e,t){const s=R(e),i=g.EMPTY_NODE.updateChild(this.indexPath_,s);return new m(t,i)}maxPost(){const e=g.EMPTY_NODE.updateChild(this.indexPath_,ct);return new m(ye,e)}toString(){return Je(this.indexPath_,0).join("/")}}class Vu extends Ht{compare(e,t){const s=e.node.compareTo(t.node);return s===0?Ce(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return m.MIN}maxPost(){return m.MAX}makePost(e,t){const s=R(e);return new m(t,s)}toString(){return".value"}}const qu=new Vu;function Gr(n){return{type:"value",snapshotNode:n}}function De(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Ze(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function et(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Gu(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class Xn{constructor(e){this.index_=e}updateChild(e,t,s,i,r,o){p(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(i).equals(s.getChild(i))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(Ze(t,a)):p(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(De(t,s)):o.trackChildChange(et(t,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return s!=null&&(e.isLeafNode()||e.forEachChild(A,(i,r)=>{t.hasChild(i)||s.trackChildChange(Ze(i,r))}),t.isLeafNode()||t.forEachChild(A,(i,r)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(et(i,r,o))}else s.trackChildChange(De(i,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?g.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class tt{constructor(e){this.indexedFilter_=new Xn(e.getIndex()),this.index_=e.getIndex(),this.startPost_=tt.getStartPost_(e),this.endPost_=tt.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,i,r,o){return this.matches(new m(t,s))||(s=g.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,i,r,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=g.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(g.EMPTY_NODE);const r=this;return t.forEachChild(A,(o,a)=>{r.matches(new m(o,a))||(i=i.updateImmediateChild(o,g.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class ju{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{const s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new tt(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,i,r,o){return this.rangedFilter_.matches(new m(t,s))||(s=g.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,i,r,o):this.fullLimitUpdateChild_(e,t,s,r,o)}updateFullNode(e,t,s){let i;if(t.isLeafNode()||t.isEmpty())i=g.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=g.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(g.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,g.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,i,r){let o;if(this.reverse_){const u=this.index_.getCompare();o=(d,f)=>u(f,d)}else o=this.index_.getCompare();const a=e;p(a.numChildren()===this.limit_,"");const l=new m(t,s),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const u=a.getImmediateChild(t);let d=i.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=i.getChildAfterChild(this.index_,d,this.reverse_);const f=d==null?1:o(d,l);if(h&&!s.isEmpty()&&f>=0)return r?.trackChildChange(et(t,s,u)),a.updateImmediateChild(t,s);{r?.trackChildChange(Ze(t,u));const I=a.updateImmediateChild(t,g.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(r?.trackChildChange(De(d.name,d.node)),I.updateImmediateChild(d.name,d.node)):I}}else return s.isEmpty()?e:h&&o(c,l)>=0?(r!=null&&(r.trackChildChange(Ze(c.name,c.node)),r.trackChildChange(De(t,s))),a.updateImmediateChild(t,s).updateImmediateChild(c.name,g.EMPTY_NODE)):e}}class Jn{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=A}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return p(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return p(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ke}hasEnd(){return this.endSet_}getIndexEndValue(){return p(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return p(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ye}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return p(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===A}copy(){const e=new Jn;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function zu(n){return n.loadsAllData()?new Xn(n.getIndex()):n.hasLimit()?new ju(n):new tt(n)}function hi(n){const e={};if(n.isDefault())return e;let t;if(n.index_===A?t="$priority":n.index_===qu?t="$value":n.index_===Ae?t="$key":(p(n.index_ instanceof Hu,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=k(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=k(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+k(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=k(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+k(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function di(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==A&&(e.i=n.index_.toString()),e}class At extends Mr{constructor(e,t,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=lt("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(p(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,s,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=At.getListenId_(e,s),a={};this.listens_[o]=a;const l=hi(e._queryParams);this.restRequest_(r+".json",l,(c,h)=>{let u=h;if(c===404&&(u=null,c=null),c===null&&this.onDataUpdate_(r,u,!1,s),Re(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",i(d,null)}})}unlisten(e,t){const s=At.getListenId_(e,t);delete this.listens_[s]}get(e){const t=hi(e._queryParams),s=e._path.toString(),i=new rt;return this.restRequest_(s+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(s,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Zo(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Ye(a.responseText)}catch{F("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&F("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}class Ku{constructor(){this.rootNode_=g.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Rt(){return{value:null,children:new Map}}function jr(n,e,t){if(y(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=v(e);n.children.has(s)||n.children.set(s,Rt());const i=n.children.get(s);e=S(e),jr(i,e,t)}}function Tn(n,e,t){n.value!==null?t(e,n.value):Yu(n,(s,i)=>{const r=new C(e.toString()+"/"+s);Tn(i,r,t)})}function Yu(n,e){n.children.forEach((t,s)=>{e(s,t)})}class Qu{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&O(this.last_,(s,i)=>{t[s]=t[s]-i}),this.last_=e,t}}const fi=10*1e3,Xu=30*1e3,Ju=300*1e3;class Zu{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Qu(e);const s=fi+(Xu-fi)*Math.random();Ge(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;O(e,(i,r)=>{r>0&&K(this.statsToReport_,i)&&(t[i]=r,s=!0)}),s&&this.server_.reportStats(t),Ge(this.reportStats_.bind(this),Math.floor(Math.random()*2*Ju))}}var q;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(q||(q={}));function Zn(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function es(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function ts(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class kt{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=q.ACK_USER_WRITE,this.source=Zn()}operationForChild(e){if(y(this.path)){if(this.affectedTree.value!=null)return p(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new C(e));return new kt(w(),t,this.revert)}}else return p(v(this.path)===e,"operationForChild called for unrelated child."),new kt(S(this.path),this.affectedTree,this.revert)}}class nt{constructor(e,t){this.source=e,this.path=t,this.type=q.LISTEN_COMPLETE}operationForChild(e){return y(this.path)?new nt(this.source,w()):new nt(this.source,S(this.path))}}class ve{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=q.OVERWRITE}operationForChild(e){return y(this.path)?new ve(this.source,w(),this.snap.getImmediateChild(e)):new ve(this.source,S(this.path),this.snap)}}class xe{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=q.MERGE}operationForChild(e){if(y(this.path)){const t=this.children.subtree(new C(e));return t.isEmpty()?null:t.value?new ve(this.source,w(),t.value):new xe(this.source,w(),t)}else return p(v(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new xe(this.source,S(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class le{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(y(e))return this.isFullyInitialized()&&!this.filtered_;const t=v(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class eh{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function th(n,e,t,s){const i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(Gu(o.childName,o.snapshotNode))}),He(n,i,"child_removed",e,s,t),He(n,i,"child_added",e,s,t),He(n,i,"child_moved",r,s,t),He(n,i,"child_changed",e,s,t),He(n,i,"value",e,s,t),i}function He(n,e,t,s,i,r){const o=s.filter(a=>a.type===t);o.sort((a,l)=>sh(n,a,l)),o.forEach(a=>{const l=nh(n,a,r);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function nh(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function sh(n,e,t){if(e.childName==null||t.childName==null)throw Me("Should only compare child_ events.");const s=new m(e.childName,e.snapshotNode),i=new m(t.childName,t.snapshotNode);return n.index_.compare(s,i)}function Vt(n,e){return{eventCache:n,serverCache:e}}function je(n,e,t,s){return Vt(new le(e,t,s),n.serverCache)}function zr(n,e,t,s){return Vt(n.eventCache,new le(e,t,s))}function Dt(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Ee(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let dn;const ih=()=>(dn||(dn=new B(Hc)),dn);class b{constructor(e,t=ih()){this.value=e,this.children=t}static fromObject(e){let t=new b(null);return O(e,(s,i)=>{t=t.set(new C(s),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:w(),value:this.value};if(y(e))return null;{const s=v(e),i=this.children.get(s);if(i!==null){const r=i.findRootMostMatchingPathAndValue(S(e),t);return r!=null?{path:N(new C(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(y(e))return this;{const t=v(e),s=this.children.get(t);return s!==null?s.subtree(S(e)):new b(null)}}set(e,t){if(y(e))return new b(t,this.children);{const s=v(e),r=(this.children.get(s)||new b(null)).set(S(e),t),o=this.children.insert(s,r);return new b(this.value,o)}}remove(e){if(y(e))return this.children.isEmpty()?new b(null):new b(null,this.children);{const t=v(e),s=this.children.get(t);if(s){const i=s.remove(S(e));let r;return i.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,i),this.value===null&&r.isEmpty()?new b(null):new b(this.value,r)}else return this}}get(e){if(y(e))return this.value;{const t=v(e),s=this.children.get(t);return s?s.get(S(e)):null}}setTree(e,t){if(y(e))return t;{const s=v(e),r=(this.children.get(s)||new b(null)).setTree(S(e),t);let o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new b(this.value,o)}}fold(e){return this.fold_(w(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(N(e,i),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,w(),t)}findOnPath_(e,t,s){const i=this.value?s(t,this.value):!1;if(i)return i;if(y(e))return null;{const r=v(e),o=this.children.get(r);return o?o.findOnPath_(S(e),N(t,r),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,w(),t)}foreachOnPath_(e,t,s){if(y(e))return this;{this.value&&s(t,this.value);const i=v(e),r=this.children.get(i);return r?r.foreachOnPath_(S(e),N(t,i),s):new b(null)}}foreach(e){this.foreach_(w(),e)}foreach_(e,t){this.children.inorderTraversal((s,i)=>{i.foreach_(N(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}class G{constructor(e){this.writeTree_=e}static empty(){return new G(new b(null))}}function ze(n,e,t){if(y(e))return new G(new b(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const i=s.path;let r=s.value;const o=L(i,e);return r=r.updateChild(o,t),new G(n.writeTree_.set(i,r))}else{const i=new b(t),r=n.writeTree_.setTree(e,i);return new G(r)}}}function Sn(n,e,t){let s=n;return O(t,(i,r)=>{s=ze(s,N(e,i),r)}),s}function pi(n,e){if(y(e))return G.empty();{const t=n.writeTree_.setTree(e,new b(null));return new G(t)}}function Nn(n,e){return Ie(n,e)!=null}function Ie(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(L(t.path,e)):null}function _i(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(A,(s,i)=>{e.push(new m(s,i))}):n.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new m(s,i.value))}),e}function ie(n,e){if(y(e))return n;{const t=Ie(n,e);return t!=null?new G(new b(t)):new G(n.writeTree_.subtree(e))}}function An(n){return n.writeTree_.isEmpty()}function Pe(n,e){return Kr(w(),n.writeTree_,e)}function Kr(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(p(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):t=Kr(N(n,i),r,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(N(n,".priority"),s)),t}}function qt(n,e){return Jr(e,n)}function rh(n,e,t,s,i){p(s>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:i}),i&&(n.visibleWrites=ze(n.visibleWrites,e,t)),n.lastWriteId=s}function oh(n,e,t,s){p(s>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:s,visible:!0}),n.visibleWrites=Sn(n.visibleWrites,e,t),n.lastWriteId=s}function ah(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function lh(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);p(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let i=s.visible,r=!1,o=n.allWrites.length-1;for(;i&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&ch(a,s.path)?i=!1:U(s.path,a.path)&&(r=!0)),o--}if(i){if(r)return uh(n),!0;if(s.snap)n.visibleWrites=pi(n.visibleWrites,s.path);else{const a=s.children;O(a,l=>{n.visibleWrites=pi(n.visibleWrites,N(s.path,l))})}return!0}else return!1}function ch(n,e){if(n.snap)return U(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&U(N(n.path,t),e))return!0;return!1}function uh(n){n.visibleWrites=Yr(n.allWrites,hh,w()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function hh(n){return n.visible}function Yr(n,e,t){let s=G.empty();for(let i=0;i<n.length;++i){const r=n[i];if(e(r)){const o=r.path;let a;if(r.snap)U(t,o)?(a=L(t,o),s=ze(s,a,r.snap)):U(o,t)&&(a=L(o,t),s=ze(s,w(),r.snap.getChild(a)));else if(r.children){if(U(t,o))a=L(t,o),s=Sn(s,a,r.children);else if(U(o,t))if(a=L(o,t),y(a))s=Sn(s,w(),r.children);else{const l=Re(r.children,v(a));if(l){const c=l.getChild(S(a));s=ze(s,w(),c)}}}else throw Me("WriteRecord should have .snap or .children")}}return s}function Qr(n,e,t,s,i){if(!s&&!i){const r=Ie(n.visibleWrites,e);if(r!=null)return r;{const o=ie(n.visibleWrites,e);if(An(o))return t;if(t==null&&!Nn(o,w()))return null;{const a=t||g.EMPTY_NODE;return Pe(o,a)}}}else{const r=ie(n.visibleWrites,e);if(!i&&An(r))return t;if(!i&&t==null&&!Nn(r,w()))return null;{const o=function(c){return(c.visible||i)&&(!s||!~s.indexOf(c.writeId))&&(U(c.path,e)||U(e,c.path))},a=Yr(n.allWrites,o,e),l=t||g.EMPTY_NODE;return Pe(a,l)}}}function dh(n,e,t){let s=g.EMPTY_NODE;const i=Ie(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(A,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(t){const r=ie(n.visibleWrites,e);return t.forEachChild(A,(o,a)=>{const l=Pe(ie(r,new C(o)),a);s=s.updateImmediateChild(o,l)}),_i(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const r=ie(n.visibleWrites,e);return _i(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function fh(n,e,t,s,i){p(s||i,"Either existingEventSnap or existingServerSnap must exist");const r=N(e,t);if(Nn(n.visibleWrites,r))return null;{const o=ie(n.visibleWrites,r);return An(o)?i.getChild(t):Pe(o,i.getChild(t))}}function ph(n,e,t,s){const i=N(e,t),r=Ie(n.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(t)){const o=ie(n.visibleWrites,i);return Pe(o,s.getNode().getImmediateChild(t))}else return null}function _h(n,e){return Ie(n.visibleWrites,e)}function gh(n,e,t,s,i,r,o){let a;const l=ie(n.visibleWrites,e),c=Ie(l,w());if(c!=null)a=c;else if(t!=null)a=Pe(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],u=o.getCompare(),d=r?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let f=d.getNext();for(;f&&h.length<i;)u(f,s)!==0&&h.push(f),f=d.getNext();return h}else return[]}function mh(){return{visibleWrites:G.empty(),allWrites:[],lastWriteId:-1}}function xt(n,e,t,s){return Qr(n.writeTree,n.treePath,e,t,s)}function ns(n,e){return dh(n.writeTree,n.treePath,e)}function gi(n,e,t,s){return fh(n.writeTree,n.treePath,e,t,s)}function Pt(n,e){return _h(n.writeTree,N(n.treePath,e))}function yh(n,e,t,s,i,r){return gh(n.writeTree,n.treePath,e,t,s,i,r)}function ss(n,e,t){return ph(n.writeTree,n.treePath,e,t)}function Xr(n,e){return Jr(N(n.treePath,e),n.writeTree)}function Jr(n,e){return{treePath:n,writeTree:e}}class vh{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;p(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),p(s!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const r=i.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(s,et(s,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(s,Ze(s,i.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(s,De(s,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(s,et(s,e.snapshotNode,i.oldSnap));else throw Me("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}class Eh{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const Zr=new Eh;class is{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new le(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ss(this.writes_,e,s)}}getChildAfterChild(e,t,s){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ee(this.viewCache_),r=yh(this.writes_,i,t,1,s,e);return r.length===0?null:r[0]}}function wh(n){return{filter:n}}function Ch(n,e){p(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),p(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Ih(n,e,t,s,i){const r=new vh;let o,a;if(t.type===q.OVERWRITE){const c=t;c.source.fromUser?o=Rn(n,e,c.path,c.snap,s,i,r):(p(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!y(c.path),o=Ot(n,e,c.path,c.snap,s,i,a,r))}else if(t.type===q.MERGE){const c=t;c.source.fromUser?o=Th(n,e,c.path,c.children,s,i,r):(p(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=kn(n,e,c.path,c.children,s,i,a,r))}else if(t.type===q.ACK_USER_WRITE){const c=t;c.revert?o=Ah(n,e,c.path,s,i,r):o=Sh(n,e,c.path,c.affectedTree,s,i,r)}else if(t.type===q.LISTEN_COMPLETE)o=Nh(n,e,t.path,s,r);else throw Me("Unknown operation type: "+t.type);const l=r.getChanges();return bh(e,o,l),{viewCache:o,changes:l}}function bh(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=Dt(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&t.push(Gr(Dt(e)))}}function eo(n,e,t,s,i,r){const o=e.eventCache;if(Pt(s,t)!=null)return e;{let a,l;if(y(t))if(p(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=Ee(e),h=c instanceof g?c:g.EMPTY_NODE,u=ns(s,h);a=n.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{const c=xt(s,Ee(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{const c=v(t);if(c===".priority"){p(ae(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const u=gi(s,t,h,l);u!=null?a=n.filter.updatePriority(h,u):a=o.getNode()}else{const h=S(t);let u;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const d=gi(s,t,o.getNode(),l);d!=null?u=o.getNode().getImmediateChild(c).updateChild(h,d):u=o.getNode().getImmediateChild(c)}else u=ss(s,c,e.serverCache);u!=null?a=n.filter.updateChild(o.getNode(),c,u,h,i,r):a=o.getNode()}}return je(e,a,o.isFullyInitialized()||y(t),n.filter.filtersNodes())}}function Ot(n,e,t,s,i,r,o,a){const l=e.serverCache;let c;const h=o?n.filter:n.filter.getIndexedFilter();if(y(t))c=h.updateFullNode(l.getNode(),s,null);else if(h.filtersNodes()&&!l.isFiltered()){const f=l.getNode().updateChild(t,s);c=h.updateFullNode(l.getNode(),f,null)}else{const f=v(t);if(!l.isCompleteForPath(t)&&ae(t)>1)return e;const _=S(t),M=l.getNode().getImmediateChild(f).updateChild(_,s);f===".priority"?c=h.updatePriority(l.getNode(),M):c=h.updateChild(l.getNode(),f,M,_,Zr,null)}const u=zr(e,c,l.isFullyInitialized()||y(t),h.filtersNodes()),d=new is(i,u,r);return eo(n,u,t,i,d,a)}function Rn(n,e,t,s,i,r,o){const a=e.eventCache;let l,c;const h=new is(i,e,r);if(y(t))c=n.filter.updateFullNode(e.eventCache.getNode(),s,o),l=je(e,c,!0,n.filter.filtersNodes());else{const u=v(t);if(u===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),s),l=je(e,c,a.isFullyInitialized(),a.isFiltered());else{const d=S(t),f=a.getNode().getImmediateChild(u);let _;if(y(d))_=s;else{const I=h.getCompleteChild(u);I!=null?Kn(d)===".priority"&&I.getChild(Fr(d)).isEmpty()?_=I:_=I.updateChild(d,s):_=g.EMPTY_NODE}if(f.equals(_))l=e;else{const I=n.filter.updateChild(a.getNode(),u,_,d,h,o);l=je(e,I,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function mi(n,e){return n.eventCache.isCompleteForChild(e)}function Th(n,e,t,s,i,r,o){let a=e;return s.foreach((l,c)=>{const h=N(t,l);mi(e,v(h))&&(a=Rn(n,a,h,c,i,r,o))}),s.foreach((l,c)=>{const h=N(t,l);mi(e,v(h))||(a=Rn(n,a,h,c,i,r,o))}),a}function yi(n,e,t){return t.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function kn(n,e,t,s,i,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;y(t)?c=s:c=new b(null).setTree(t,s);const h=e.serverCache.getNode();return c.children.inorderTraversal((u,d)=>{if(h.hasChild(u)){const f=e.serverCache.getNode().getImmediateChild(u),_=yi(n,f,d);l=Ot(n,l,new C(u),_,i,r,o,a)}}),c.children.inorderTraversal((u,d)=>{const f=!e.serverCache.isCompleteForChild(u)&&d.value===null;if(!h.hasChild(u)&&!f){const _=e.serverCache.getNode().getImmediateChild(u),I=yi(n,_,d);l=Ot(n,l,new C(u),I,i,r,o,a)}}),l}function Sh(n,e,t,s,i,r,o){if(Pt(i,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(y(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Ot(n,e,t,l.getNode().getChild(t),i,r,a,o);if(y(t)){let c=new b(null);return l.getNode().forEachChild(Ae,(h,u)=>{c=c.set(new C(h),u)}),kn(n,e,t,c,i,r,a,o)}else return e}else{let c=new b(null);return s.foreach((h,u)=>{const d=N(t,h);l.isCompleteForPath(d)&&(c=c.set(h,l.getNode().getChild(d)))}),kn(n,e,t,c,i,r,a,o)}}function Nh(n,e,t,s,i){const r=e.serverCache,o=zr(e,r.getNode(),r.isFullyInitialized()||y(t),r.isFiltered());return eo(n,o,t,s,Zr,i)}function Ah(n,e,t,s,i,r){let o;if(Pt(s,t)!=null)return e;{const a=new is(s,e,i),l=e.eventCache.getNode();let c;if(y(t)||v(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=xt(s,Ee(e));else{const u=e.serverCache.getNode();p(u instanceof g,"serverChildren would be complete if leaf node"),h=ns(s,u)}h=h,c=n.filter.updateFullNode(l,h,r)}else{const h=v(t);let u=ss(s,h,e.serverCache);u==null&&e.serverCache.isCompleteForChild(h)&&(u=l.getImmediateChild(h)),u!=null?c=n.filter.updateChild(l,h,u,S(t),a,r):e.eventCache.getNode().hasChild(h)?c=n.filter.updateChild(l,h,g.EMPTY_NODE,S(t),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=xt(s,Ee(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||Pt(s,w())!=null,je(e,c,o,n.filter.filtersNodes())}}class Rh{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,i=new Xn(s.getIndex()),r=zu(s);this.processor_=wh(r);const o=t.serverCache,a=t.eventCache,l=i.updateFullNode(g.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(g.EMPTY_NODE,a.getNode(),null),h=new le(l,o.isFullyInitialized(),i.filtersNodes()),u=new le(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Vt(u,h),this.eventGenerator_=new eh(this.query_)}get query(){return this.query_}}function kh(n){return n.viewCache_.serverCache.getNode()}function Dh(n){return Dt(n.viewCache_)}function xh(n,e){const t=Ee(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!y(e)&&!t.getImmediateChild(v(e)).isEmpty())?t.getChild(e):null}function vi(n){return n.eventRegistrations_.length===0}function Ph(n,e){n.eventRegistrations_.push(e)}function Ei(n,e,t){const s=[];if(t){p(e==null,"A cancel should cancel all event registrations.");const i=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return s}function wi(n,e,t,s){e.type===q.MERGE&&e.source.queryId!==null&&(p(Ee(n.viewCache_),"We should always have a full cache before handling merges"),p(Dt(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,r=Ih(n.processor_,i,e,t,s);return Ch(n.processor_,r.viewCache),p(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,to(n,r.changes,r.viewCache.eventCache.getNode(),null)}function Oh(n,e){const t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(A,(r,o)=>{s.push(De(r,o))}),t.isFullyInitialized()&&s.push(Gr(t.getNode())),to(n,s,t.getNode(),e)}function to(n,e,t,s){const i=s?[s]:n.eventRegistrations_;return th(n.eventGenerator_,e,t,i)}let Mt;class no{constructor(){this.views=new Map}}function Mh(n){p(!Mt,"__referenceConstructor has already been defined"),Mt=n}function Lh(){return p(Mt,"Reference.ts has not been loaded"),Mt}function Fh(n){return n.views.size===0}function rs(n,e,t,s){const i=e.source.queryId;if(i!==null){const r=n.views.get(i);return p(r!=null,"SyncTree gave us an op for an invalid query."),wi(r,e,t,s)}else{let r=[];for(const o of n.views.values())r=r.concat(wi(o,e,t,s));return r}}function so(n,e,t,s,i){const r=e._queryIdentifier,o=n.views.get(r);if(!o){let a=xt(t,i?s:null),l=!1;a?l=!0:s instanceof g?(a=ns(t,s),l=!1):(a=g.EMPTY_NODE,l=!1);const c=Vt(new le(a,l,!1),new le(s,i,!1));return new Rh(e,c)}return o}function Bh(n,e,t,s,i,r){const o=so(n,e,s,i,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),Ph(o,t),Oh(o,t)}function $h(n,e,t,s){const i=e._queryIdentifier,r=[];let o=[];const a=ce(n);if(i==="default")for(const[l,c]of n.views.entries())o=o.concat(Ei(c,t,s)),vi(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{const l=n.views.get(i);l&&(o=o.concat(Ei(l,t,s)),vi(l)&&(n.views.delete(i),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!ce(n)&&r.push(new(Lh())(e._repo,e._path)),{removed:r,events:o}}function io(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function re(n,e){let t=null;for(const s of n.views.values())t=t||xh(s,e);return t}function ro(n,e){if(e._queryParams.loadsAllData())return Gt(n);{const s=e._queryIdentifier;return n.views.get(s)}}function oo(n,e){return ro(n,e)!=null}function ce(n){return Gt(n)!=null}function Gt(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Lt;function Wh(n){p(!Lt,"__referenceConstructor has already been defined"),Lt=n}function Uh(){return p(Lt,"Reference.ts has not been loaded"),Lt}let Hh=1;class Ci{constructor(e){this.listenProvider_=e,this.syncPointTree_=new b(null),this.pendingWriteTree_=mh(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function ao(n,e,t,s,i){return rh(n.pendingWriteTree_,e,t,s,i),i?Fe(n,new ve(Zn(),e,t)):[]}function Vh(n,e,t,s){oh(n.pendingWriteTree_,e,t,s);const i=b.fromObject(t);return Fe(n,new xe(Zn(),e,i))}function te(n,e,t=!1){const s=ah(n.pendingWriteTree_,e);if(lh(n.pendingWriteTree_,e)){let r=new b(null);return s.snap!=null?r=r.set(w(),!0):O(s.children,o=>{r=r.set(new C(o),!0)}),Fe(n,new kt(s.path,r,t))}else return[]}function ut(n,e,t){return Fe(n,new ve(es(),e,t))}function qh(n,e,t){const s=b.fromObject(t);return Fe(n,new xe(es(),e,s))}function Gh(n,e){return Fe(n,new nt(es(),e))}function jh(n,e,t){const s=as(n,t);if(s){const i=ls(s),r=i.path,o=i.queryId,a=L(r,e),l=new nt(ts(o),a);return cs(n,r,l)}else return[]}function lo(n,e,t,s,i=!1){const r=e._path,o=n.syncPointTree_.get(r);let a=[];if(o&&(e._queryIdentifier==="default"||oo(o,e))){const l=$h(o,e,t,s);Fh(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const c=l.removed;if(a=l.events,!i){const h=c.findIndex(d=>d._queryParams.loadsAllData())!==-1,u=n.syncPointTree_.findOnPath(r,(d,f)=>ce(f));if(h&&!u){const d=n.syncPointTree_.subtree(r);if(!d.isEmpty()){const f=Qh(d);for(let _=0;_<f.length;++_){const I=f[_],M=I.query,be=fo(n,I);n.listenProvider_.startListening(Ke(M),st(n,M),be.hashFn,be.onComplete)}}}!u&&c.length>0&&!s&&(h?n.listenProvider_.stopListening(Ke(e),null):c.forEach(d=>{const f=n.queryToTagMap.get(jt(d));n.listenProvider_.stopListening(Ke(d),f)}))}Xh(n,c)}return a}function co(n,e,t,s){const i=as(n,s);if(i!=null){const r=ls(i),o=r.path,a=r.queryId,l=L(o,e),c=new ve(ts(a),l,t);return cs(n,o,c)}else return[]}function zh(n,e,t,s){const i=as(n,s);if(i){const r=ls(i),o=r.path,a=r.queryId,l=L(o,e),c=b.fromObject(t),h=new xe(ts(a),l,c);return cs(n,o,h)}else return[]}function Kh(n,e,t,s=!1){const i=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(i,(d,f)=>{const _=L(d,i);r=r||re(f,_),o=o||ce(f)});let a=n.syncPointTree_.get(i);a?(o=o||ce(a),r=r||re(a,w())):(a=new no,n.syncPointTree_=n.syncPointTree_.set(i,a));let l;r!=null?l=!0:(l=!1,r=g.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((f,_)=>{const I=re(_,w());I&&(r=r.updateImmediateChild(f,I))}));const c=oo(a,e);if(!c&&!e._queryParams.loadsAllData()){const d=jt(e);p(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");const f=Jh();n.queryToTagMap.set(d,f),n.tagToQueryMap.set(f,d)}const h=qt(n.pendingWriteTree_,i);let u=Bh(a,e,t,h,r,l);if(!c&&!o&&!s){const d=ro(a,e);u=u.concat(Zh(n,e,d))}return u}function os(n,e,t){const i=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=L(o,e),c=re(a,l);if(c)return c});return Qr(i,e,r,t,!0)}function Yh(n,e){const t=e._path;let s=null;n.syncPointTree_.foreachOnPath(t,(c,h)=>{const u=L(c,t);s=s||re(h,u)});let i=n.syncPointTree_.get(t);i?s=s||re(i,w()):(i=new no,n.syncPointTree_=n.syncPointTree_.set(t,i));const r=s!=null,o=r?new le(s,!0,!1):null,a=qt(n.pendingWriteTree_,e._path),l=so(i,e,a,r?o.getNode():g.EMPTY_NODE,r);return Dh(l)}function Fe(n,e){return uo(e,n.syncPointTree_,null,qt(n.pendingWriteTree_,w()))}function uo(n,e,t,s){if(y(n.path))return ho(n,e,t,s);{const i=e.get(w());t==null&&i!=null&&(t=re(i,w()));let r=[];const o=v(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const c=t?t.getImmediateChild(o):null,h=Xr(s,o);r=r.concat(uo(a,l,c,h))}return i&&(r=r.concat(rs(i,n,s,t))),r}}function ho(n,e,t,s){const i=e.get(w());t==null&&i!=null&&(t=re(i,w()));let r=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,c=Xr(s,o),h=n.operationForChild(o);h&&(r=r.concat(ho(h,a,l,c)))}),i&&(r=r.concat(rs(i,n,s,t))),r}function fo(n,e){const t=e.query,s=st(n,t);return{hashFn:()=>(kh(e)||g.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return s?jh(n,t._path,s):Gh(n,t._path);{const r=Gc(i,t);return lo(n,t,null,r)}}}}function st(n,e){const t=jt(e);return n.queryToTagMap.get(t)}function jt(n){return n._path.toString()+"$"+n._queryIdentifier}function as(n,e){return n.tagToQueryMap.get(e)}function ls(n){const e=n.indexOf("$");return p(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new C(n.substr(0,e))}}function cs(n,e,t){const s=n.syncPointTree_.get(e);p(s,"Missing sync point for query tag that we're tracking");const i=qt(n.pendingWriteTree_,e);return rs(s,t,i,null)}function Qh(n){return n.fold((e,t,s)=>{if(t&&ce(t))return[Gt(t)];{let i=[];return t&&(i=io(t)),O(s,(r,o)=>{i=i.concat(o)}),i}})}function Ke(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Uh())(n._repo,n._path):n}function Xh(n,e){for(let t=0;t<e.length;++t){const s=e[t];if(!s._queryParams.loadsAllData()){const i=jt(s),r=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(r)}}}function Jh(){return Hh++}function Zh(n,e,t){const s=e._path,i=st(n,e),r=fo(n,t),o=n.listenProvider_.startListening(Ke(e),i,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(s);if(i)p(!ce(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,h,u)=>{if(!y(c)&&h&&ce(h))return[Gt(h).query];{let d=[];return h&&(d=d.concat(io(h).map(f=>f.query))),O(u,(f,_)=>{d=d.concat(_)}),d}});for(let c=0;c<l.length;++c){const h=l[c];n.listenProvider_.stopListening(Ke(h),st(n,h))}}return o}class us{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new us(t)}node(){return this.node_}}class hs{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=N(this.path_,e);return new hs(this.syncTree_,t)}node(){return os(this.syncTree_,this.path_)}}const ed=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Ii=function(n,e,t){if(!n||typeof n!="object")return n;if(p(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return td(n[".sv"],e,t);if(typeof n[".sv"]=="object")return nd(n[".sv"],e);p(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},td=function(n,e,t){if(n==="timestamp")return t.timestamp;p(!1,"Unexpected server value: "+n)},nd=function(n,e,t){n.hasOwnProperty("increment")||p(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&p(!1,"Unexpected increment value: "+s);const i=e.node();if(p(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;const o=i.getValue();return typeof o!="number"?s:o+s},po=function(n,e,t,s){return ds(e,new hs(t,n),s)},_o=function(n,e,t){return ds(n,new us(e),t)};function ds(n,e,t){const s=n.getPriority().val(),i=Ii(s,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,a=Ii(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new D(a,R(i)):n}else{const o=n;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new D(i))),o.forEachChild(A,(a,l)=>{const c=ds(l,e.getImmediateChild(a),t);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}class fs{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function ps(n,e){let t=e instanceof C?e:new C(e),s=n,i=v(t);for(;i!==null;){const r=Re(s.node.children,i)||{children:{},childCount:0};s=new fs(i,s,r),t=S(t),i=v(t)}return s}function Be(n){return n.node.value}function go(n,e){n.node.value=e,Dn(n)}function mo(n){return n.node.childCount>0}function sd(n){return Be(n)===void 0&&!mo(n)}function zt(n,e){O(n.node.children,(t,s)=>{e(new fs(t,n,s))})}function yo(n,e,t,s){t&&e(n),zt(n,i=>{yo(i,e,!0)})}function id(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function ht(n){return new C(n.parent===null?n.name:ht(n.parent)+"/"+n.name)}function Dn(n){n.parent!==null&&rd(n.parent,n.name,n)}function rd(n,e,t){const s=sd(t),i=K(n.node.children,e);s&&i?(delete n.node.children[e],n.node.childCount--,Dn(n)):!s&&!i&&(n.node.children[e]=t.node,n.node.childCount++,Dn(n))}const od=/[\[\].#$\/\u0000-\u001F\u007F]/,ad=/[\[\].#$\u0000-\u001F\u007F]/,fn=10*1024*1024,_s=function(n){return typeof n=="string"&&n.length!==0&&!od.test(n)},vo=function(n){return typeof n=="string"&&n.length!==0&&!ad.test(n)},ld=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),vo(n)},cd=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Vn(n)||n&&typeof n=="object"&&K(n,".sv")},ud=function(n,e,t,s){Kt(Bt(n,"value"),e,t)},Kt=function(n,e,t){const s=t instanceof C?new Tu(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+fe(s));if(typeof e=="function")throw new Error(n+"contains a function "+fe(s)+" with contents = "+e.toString());if(Vn(e))throw new Error(n+"contains "+e.toString()+" "+fe(s));if(typeof e=="string"&&e.length>fn/3&&$t(e)>fn)throw new Error(n+"contains a string greater than "+fn+" utf8 bytes "+fe(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(O(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!_s(o)))throw new Error(n+" contains an invalid key ("+o+") "+fe(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Su(s,o),Kt(n,a,s),Nu(s)}),i&&r)throw new Error(n+' contains ".value" child '+fe(s)+" in addition to actual children.")}},hd=function(n,e){let t,s;for(t=0;t<e.length;t++){s=e[t];const r=Je(s);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!_s(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+s.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(bu);let i=null;for(t=0;t<e.length;t++){if(s=e[t],i!==null&&U(i,s))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+s.toString());i=s}},dd=function(n,e,t,s){const i=Bt(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const r=[];O(e,(o,a)=>{const l=new C(o);if(Kt(i,a,N(t,l)),Kn(l)===".priority"&&!cd(a))throw new Error(i+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),hd(i,r)},Eo=function(n,e,t,s){if(!vo(t))throw new Error(Bt(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},fd=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Eo(n,e,t)},pd=function(n,e){if(v(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},_d=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!_s(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!ld(t))throw new Error(Bt(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class gd{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function gs(n,e){let t=null;for(let s=0;s<e.length;s++){const i=e[s],r=i.getPath();t!==null&&!Br(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(i)}t&&n.eventLists_.push(t)}function H(n,e,t){gs(n,t),md(n,s=>U(s,e)||U(e,s))}function md(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const i=n.eventLists_[s];if(i){const r=i.path;e(r)?(yd(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function yd(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();qe&&P("event: "+t.toString()),Le(s)}}}const vd="repo_interrupt",Ed=25;class wd{constructor(e,t,s,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new gd,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Rt(),this.transactionQueueTree_=new fs,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Cd(n,e,t){if(n.stats_=jn(n.repoInfo_),n.forceRestClient_||Yc())n.server_=new At(n.repoInfo_,(s,i,r,o)=>{bi(n,s,i,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Ti(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{k(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new Q(n.repoInfo_,e,(s,i,r,o)=>{bi(n,s,i,r,o)},s=>{Ti(n,s)},s=>{bd(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=eu(n.repoInfo_,()=>new Zu(n.stats_,n.server_)),n.infoData_=new Ku,n.infoSyncTree_=new Ci({startListening:(s,i,r,o)=>{let a=[];const l=n.infoData_.getNode(s._path);return l.isEmpty()||(a=ut(n.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),ms(n,"connected",!1),n.serverSyncTree_=new Ci({startListening:(s,i,r,o)=>(n.server_.listen(s,r,i,(a,l)=>{const c=o(a,l);H(n.eventQueue_,s._path,c)}),[]),stopListening:(s,i)=>{n.server_.unlisten(s,i)}})}function Id(n){const t=n.infoData_.getNode(new C(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Yt(n){return ed({timestamp:Id(n)})}function bi(n,e,t,s,i){n.dataUpdateCount++;const r=new C(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(s){const l=Et(t,c=>R(c));o=zh(n.serverSyncTree_,r,l,i)}else{const l=R(t);o=co(n.serverSyncTree_,r,l,i)}else if(s){const l=Et(t,c=>R(c));o=qh(n.serverSyncTree_,r,l)}else{const l=R(t);o=ut(n.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=Oe(n,r)),H(n.eventQueue_,a,o)}function Ti(n,e){ms(n,"connected",e),e===!1&&Ad(n)}function bd(n,e){O(e,(t,s)=>{ms(n,t,s)})}function ms(n,e,t){const s=new C("/.info/"+e),i=R(t);n.infoData_.updateSnapshot(s,i);const r=ut(n.infoSyncTree_,s,i);H(n.eventQueue_,s,r)}function ys(n){return n.nextWriteId_++}function Td(n,e,t){const s=Yh(n.serverSyncTree_,e);return s!=null?Promise.resolve(s):n.server_.get(e).then(i=>{const r=R(i).withIndex(e._queryParams.getIndex());Kh(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=ut(n.serverSyncTree_,e._path,r);else{const a=st(n.serverSyncTree_,e);o=co(n.serverSyncTree_,e._path,r,a)}return H(n.eventQueue_,e._path,o),lo(n.serverSyncTree_,e,t,null,!0),r},i=>(dt(n,"get for query "+k(e)+" failed: "+i),Promise.reject(new Error(i))))}function Sd(n,e,t,s,i){dt(n,"set",{path:e.toString(),value:t,priority:s});const r=Yt(n),o=R(t,s),a=os(n.serverSyncTree_,e),l=_o(o,a,r),c=ys(n),h=ao(n.serverSyncTree_,e,l,c,!0);gs(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(d,f)=>{const _=d==="ok";_||F("set at "+e+" failed: "+d);const I=te(n.serverSyncTree_,c,!_);H(n.eventQueue_,e,I),xn(n,i,d,f)});const u=Es(n,e);Oe(n,u),H(n.eventQueue_,u,[])}function Nd(n,e,t,s){dt(n,"update",{path:e.toString(),value:t});let i=!0;const r=Yt(n),o={};if(O(t,(a,l)=>{i=!1,o[a]=po(N(e,a),R(l),n.serverSyncTree_,r)}),i)P("update() called with empty data.  Don't do anything."),xn(n,s,"ok",void 0);else{const a=ys(n),l=Vh(n.serverSyncTree_,e,o,a);gs(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,h)=>{const u=c==="ok";u||F("update at "+e+" failed: "+c);const d=te(n.serverSyncTree_,a,!u),f=d.length>0?Oe(n,e):e;H(n.eventQueue_,f,d),xn(n,s,c,h)}),O(t,c=>{const h=Es(n,N(e,c));Oe(n,h)}),H(n.eventQueue_,e,[])}}function Ad(n){dt(n,"onDisconnectEvents");const e=Yt(n),t=Rt();Tn(n.onDisconnect_,w(),(i,r)=>{const o=po(i,r,n.serverSyncTree_,e);jr(t,i,o)});let s=[];Tn(t,w(),(i,r)=>{s=s.concat(ut(n.serverSyncTree_,i,r));const o=Es(n,i);Oe(n,o)}),n.onDisconnect_=Rt(),H(n.eventQueue_,w(),s)}function Rd(n){n.persistentConnection_&&n.persistentConnection_.interrupt(vd)}function dt(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),P(t,...e)}function xn(n,e,t,s){e&&Le(()=>{if(t==="ok")e(null);else{const i=(t||"error").toUpperCase();let r=i;s&&(r+=": "+s);const o=new Error(r);o.code=i,e(o)}})}function wo(n,e,t){return os(n.serverSyncTree_,e,t)||g.EMPTY_NODE}function vs(n,e=n.transactionQueueTree_){if(e||Qt(n,e),Be(e)){const t=Io(n,e);p(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&kd(n,ht(e),t)}else mo(e)&&zt(e,t=>{vs(n,t)})}function kd(n,e,t){const s=t.map(c=>c.currentWriteId),i=wo(n,e,s);let r=i;const o=i.hash();for(let c=0;c<t.length;c++){const h=t[c];p(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const u=L(e,h.path);r=r.updateChild(u,h.currentOutputSnapshotRaw)}const a=r.val(!0),l=e;n.server_.put(l.toString(),a,c=>{dt(n,"transaction put response",{path:l.toString(),status:c});let h=[];if(c==="ok"){const u=[];for(let d=0;d<t.length;d++)t[d].status=2,h=h.concat(te(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&u.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();Qt(n,ps(n.transactionQueueTree_,e)),vs(n,n.transactionQueueTree_),H(n.eventQueue_,e,h);for(let d=0;d<u.length;d++)Le(u[d])}else{if(c==="datastale")for(let u=0;u<t.length;u++)t[u].status===3?t[u].status=4:t[u].status=0;else{F("transaction at "+l.toString()+" failed: "+c);for(let u=0;u<t.length;u++)t[u].status=4,t[u].abortReason=c}Oe(n,e)}},o)}function Oe(n,e){const t=Co(n,e),s=ht(t),i=Io(n,t);return Dd(n,i,s),s}function Dd(n,e,t){if(e.length===0)return;const s=[];let i=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],c=L(t,l.path);let h=!1,u;if(p(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,u=l.abortReason,i=i.concat(te(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=Ed)h=!0,u="maxretry",i=i.concat(te(n.serverSyncTree_,l.currentWriteId,!0));else{const d=wo(n,l.path,o);l.currentInputSnapshot=d;const f=e[a].update(d.val());if(f!==void 0){Kt("transaction failed: Data returned ",f,l.path);let _=R(f);typeof f=="object"&&f!=null&&K(f,".priority")||(_=_.updatePriority(d.getPriority()));const M=l.currentWriteId,be=Yt(n),_t=_o(_,d,be);l.currentOutputSnapshotRaw=_,l.currentOutputSnapshotResolved=_t,l.currentWriteId=ys(n),o.splice(o.indexOf(M),1),i=i.concat(ao(n.serverSyncTree_,l.path,_t,l.currentWriteId,l.applyLocally)),i=i.concat(te(n.serverSyncTree_,M,!0))}else h=!0,u="nodata",i=i.concat(te(n.serverSyncTree_,l.currentWriteId,!0))}H(n.eventQueue_,t,i),i=[],h&&(e[a].status=2,(function(d){setTimeout(d,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(u==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(u),!1,null))))}Qt(n,n.transactionQueueTree_);for(let a=0;a<s.length;a++)Le(s[a]);vs(n,n.transactionQueueTree_)}function Co(n,e){let t,s=n.transactionQueueTree_;for(t=v(e);t!==null&&Be(s)===void 0;)s=ps(s,t),e=S(e),t=v(e);return s}function Io(n,e){const t=[];return bo(n,e,t),t.sort((s,i)=>s.order-i.order),t}function bo(n,e,t){const s=Be(e);if(s)for(let i=0;i<s.length;i++)t.push(s[i]);zt(e,i=>{bo(n,i,t)})}function Qt(n,e){const t=Be(e);if(t){let s=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[s]=t[i],s++);t.length=s,go(e,t.length>0?t:void 0)}zt(e,s=>{Qt(n,s)})}function Es(n,e){const t=ht(Co(n,e)),s=ps(n.transactionQueueTree_,e);return id(s,i=>{pn(n,i)}),pn(n,s),yo(s,i=>{pn(n,i)}),t}function pn(n,e){const t=Be(e);if(t){const s=[];let i=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(p(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(p(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(te(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?go(e,void 0):t.length=r+1,H(n.eventQueue_,ht(e),i);for(let o=0;o<s.length;o++)Le(s[o])}}function xd(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let i=t[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function Pd(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):F(`Invalid query segment '${t}' in query '${n}'`)}return e}const Si=function(n,e){const t=Od(n),s=t.namespace;t.domain==="firebase.com"&&Z(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&Z("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Wc();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Ar(t.host,t.secure,s,i,e,"",s!==t.subdomain),path:new C(t.pathString)}},Od=function(n){let e="",t="",s="",i="",r="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let h=n.indexOf("/");h===-1&&(h=n.length);let u=n.indexOf("?");u===-1&&(u=n.length),e=n.substring(0,Math.min(h,u)),h<u&&(i=xd(n.substring(h,u)));const d=Pd(n.substring(Math.min(n.length,u)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;const f=e.slice(0,c);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{const _=e.indexOf(".");s=e.substring(0,_).toLowerCase(),t=e.substring(_+1),r=s}"ns"in d&&(r=d.ns)}return{host:e,port:l,domain:t,subdomain:s,secure:o,scheme:a,pathString:i,namespace:r}};class Md{constructor(e,t,s,i){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+k(this.snapshot.exportVal())}}class Ld{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Fd{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return p(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class ws{constructor(e,t,s,i){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=i}get key(){return y(this._path)?null:Kn(this._path)}get ref(){return new ee(this._repo,this._path)}get _queryIdentifier(){const e=di(this._queryParams),t=qn(e);return t==="{}"?"default":t}get _queryObject(){return di(this._queryParams)}isEqual(e){if(e=he(e),!(e instanceof ws))return!1;const t=this._repo===e._repo,s=Br(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Iu(this._path)}}class ee extends ws{constructor(e,t){super(e,t,new Jn,!1)}get parent(){const e=Fr(this._path);return e===null?null:new ee(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class it{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new C(e),s=Pn(this.ref,e);return new it(this._node.getChild(t),s,A)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,i)=>e(new it(i,Pn(this.ref,s),A)))}hasChild(e){const t=new C(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Cs(n,e){return n=he(n),n._checkNotDeleted("ref"),e!==void 0?Pn(n._root,e):n._root}function Pn(n,e){return n=he(n),v(n._path)===null?fd("child","path",e):Eo("child","path",e),new ee(n._repo,N(n._path,e))}function Bd(n,e){n=he(n),pd("set",n._path),ud("set",e,n._path);const t=new rt;return Sd(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function $d(n,e){dd("update",e,n._path);const t=new rt;return Nd(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Wd(n){n=he(n);const e=new Fd(()=>{}),t=new Is(e);return Td(n._repo,n,t).then(s=>new it(s,new ee(n._repo,n._path),n._queryParams.getIndex()))}class Is{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const s=t._queryParams.getIndex();return new Md("value",this,new it(e.snapshotNode,new ee(t._repo,t._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Ld(this,e,t):null}matches(e){return e instanceof Is?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}Mh(ee);Wh(ee);const Ud="FIREBASE_DATABASE_EMULATOR_HOST",On={};let Hd=!1;function Vd(n,e,t,s){n.repoInfo_=new Ar(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),s&&(n.authTokenProvider_=s)}function qd(n,e,t,s,i){let r=s||n.options.databaseURL;r===void 0&&(n.options.projectId||Z("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),P("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Si(r,i),a=o.repoInfo,l;typeof process<"u"&&Ks&&(l=Ks[Ud]),l?(r=`http://${l}?ns=${a.namespace}`,o=Si(r,i),a=o.repoInfo):o.repoInfo.secure;const c=new Xc(n.name,n.options,e);_d("Invalid Firebase Database URL",o),y(o.path)||Z("Database URL must point to the root of a Firebase Database (not including a child path).");const h=jd(a,n,c,new Qc(n.name,t));return new zd(h,n)}function Gd(n,e){const t=On[e];(!t||t[n.key]!==n)&&Z(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Rd(n),delete t[n.key]}function jd(n,e,t,s){let i=On[e.name];i||(i={},On[e.name]=i);let r=i[n.toURLString()];return r&&Z("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new wd(n,Hd,t,s),i[n.toURLString()]=r,r}class zd{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Cd(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ee(this._repo,w())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Gd(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Z("Cannot call "+e+" on a deleted database.")}}function Kd(n=Vi(),e){const t=ot(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const s=Uo("database");s&&Yd(t,...s)}return t}function Yd(n,e,t,s={}){n=he(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Z("Cannot call useEmulator() after instance has already been initialized.");const i=n._repoInternal;let r;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&Z('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new yt(yt.OWNER);else if(s.mockUserToken){const o=typeof s.mockUserToken=="string"?s.mockUserToken:Ho(s.mockUserToken,n.app.options.projectId);r=new yt(o)}Vd(i,e,t,r)}function Qd(n){Oc(sl),oe(new X("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return qd(s,i,r,t)},"PUBLIC").setMultipleInstances(!0)),j(Ys,Qs,n),j(Ys,Qs,"esm2017")}Q.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Q.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Qd();const Xd={apiKey:"AIzaSyC4iNdPw5yaSiq3JQCkS-cawuCxRA39qvY",authDomain:"moneymanager-5pg.firebaseapp.com",projectId:"moneymanager-5pg",storageBucket:"moneymanager-5pg.firebasestorage.app",messagingSenderId:"992053363688",appId:"1:992053363688:web:6f65046b771508b8bf1a5d",measurementId:"G-4Z8H3CK9WP"},To=Hi(Xd);let Jd;try{Jd=kc(To)}catch{}const bs=Kd(To),Ni=async(n,e)=>{try{return await Bd(Cs(bs,`weeks/${n}`),e),{success:!0}}catch(t){return console.error("Error saving week data:",t),{success:!1,error:t}}},Zd=async n=>{try{const e=await Wd(Cs(bs,`weeks/${n}`));return e.exists()?{success:!0,data:e.val()}:{success:!0,data:null}}catch(e){return console.error("Error getting week data:",e),{success:!1,error:e}}},ft=async(n,e)=>{try{return await $d(Cs(bs,`weeks/${n}`),e),{success:!0}}catch(t){return console.error("Error updating week data:",t),{success:!1,error:t}}},Ts=["food","petrol","things","snacks"];let E={budgetHistory:[],groceries:{amount:0,lastUpdated:null},expenses:{food:[],petrol:[],things:[],snacks:[]},allExpenses:[]};const Xt=new Date,pt=Xt.toLocaleDateString(),So=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][Xt.getDay()],z=ef(Xt);function No(n=new Date){const e=new Date(n),t=e.getDay(),s=e.getDate()-t+(t===0?-6:1);return new Date(e.setDate(s))}function ef(n=new Date){return No(n).toISOString().split("T")[0]}const tf=(n,e)=>{try{return localStorage.setItem(`week_${n}`,JSON.stringify(e)),{success:!0}}catch(t){return console.error("Error saving to local storage:",t),{success:!1}}},nf=n=>{try{const e=localStorage.getItem(`week_${n}`);return{success:!0,data:e?JSON.parse(e):null}}catch(e){return console.error("Error reading from local storage:",e),{success:!0,data:null}}};async function sf(){document.getElementById("date-display").textContent=pt,document.getElementById("day-display").textContent=So;let n={success:!0,data:null};try{n=await Zd(z)}catch{console.log("Firebase failed, using local storage")}if((!n.success||!n.data)&&(n=nf(z)),n.success&&n.data)E=n.data;else{const e={weekStartDate:No(Xt).toISOString().split("T")[0],budgetHistory:[],groceries:{amount:0,lastUpdated:null},expenses:{food:[],petrol:[],things:[],snacks:[]},allExpenses:[]};E=e,rf(e,!0)}ue()}async function rf(n,e=!1){try{e?await Ni(z,n):await Ni(z,n)}catch{tf(z,n)}}const Jt=()=>(E.budgetHistory||[]).reduce((n,e)=>n+e.amount,0),Ss=()=>{let n=0;return Ts.forEach(e=>{n+=(E.expenses[e]||[]).reduce((t,s)=>t+s.amount,0)}),n+=E.groceries?.amount||0,n},Ns=()=>Jt()-Ss(),Ao=()=>{const n=Ns(),e=Jt();return e===0?"white":n<0?"red":n<e*.1?"gold":"green"};function ue(){of(),af()}function of(){const n=Jt(),e=Ao(),t=document.getElementById("total-budget-display");t&&(t.textContent=` ${n}`,t.className=e);const s=document.getElementById("groceries-display"),i=document.getElementById("groceries-last-updated");s&&(s.textContent=` ${E.groceries.amount}`,E.groceries.lastUpdated?i.textContent=`Last updated: ${E.groceries.lastUpdated}`:i.textContent="");const r=document.getElementById("expense-grid");r&&(r.innerHTML="",Ts.forEach(c=>{const h=document.createElement("div");h.className="expense-box",h.innerHTML=`
                <h4>${c}</h4>
                <div class="add-input-group">
                    <input type="number" placeholder="+" id="input-${c}">
                    <button id="btn-add-${c}">Add</button>
                </div>
                <div class="expense-list" id="list-${c}"></div>
            `,r.appendChild(h),h.querySelector(`#btn-add-${c}`).addEventListener("click",()=>Ai(c)),h.querySelector(`#input-${c}`).addEventListener("keypress",d=>{d.key==="Enter"&&Ai(c)});const u=h.querySelector(`#list-${c}`);(E.expenses[c]||[]).forEach(d=>{const f=document.createElement("div");if(window.editingExpense&&window.editingExpense.id===d.id&&window.editingExpense.category===c)f.className="expense-item",f.innerHTML=`
                        <div class="edit-input-group">
                            <input type="number" value="${window.editValue}" id="edit-val-${d.id}">
                            <button id="save-${d.id}">Save</button>
                            <button id="cancel-${d.id}">Cancel</button>
                        </div>
                    `,u.appendChild(f),document.getElementById(`save-${d.id}`).addEventListener("click",()=>lf(c,d.id)),document.getElementById(`cancel-${d.id}`).addEventListener("click",()=>{window.editingExpense=null,ue()}),document.getElementById(`edit-val-${d.id}`).addEventListener("input",_=>{window.editValue=_.target.value});else{f.className="expense-item";let _="";d.date===pt&&(_=`
                          <div class="expense-actions">
                            <button class="edit-btn" data-id="${d.id}" data-cat="${c}"></button>
                            <button class="delete-btn" data-id="${d.id}" data-cat="${c}"></button>
                          </div>
                         `),f.innerHTML=`
                        <div>
                          <span>${d.time}</span>
                          <span class="expense-amount">${d.amount}</span>
                        </div>
                        ${_}
                    `,u.appendChild(f)}})}),document.querySelectorAll(".edit-btn").forEach(c=>{c.addEventListener("click",h=>{const u=Number(h.target.getAttribute("data-id")),d=h.target.getAttribute("data-cat"),f=E.expenses[d].find(_=>_.id===u);f&&(window.editingExpense={id:u,category:d},window.editValue=f.amount,ue())})}),document.querySelectorAll(".delete-btn").forEach(c=>{c.addEventListener("click",h=>{const u=Number(h.target.getAttribute("data-id")),d=h.target.getAttribute("data-cat");cf(d,u)})}));const o=document.getElementById("summary-budget"),a=document.getElementById("summary-expenses"),l=document.getElementById("summary-balance");o&&(o.textContent=`${n}`,a.textContent=`${Ss()}`,l.textContent=`Balance: ${Ns()}`,l.className=`balance ${e}`)}function af(){const n=Jt(),e=Ao();document.getElementById("monthly-summary-budget").textContent=`${n}`,document.getElementById("monthly-summary-expenses").textContent=`${Ss()}`;const t=document.getElementById("monthly-summary-balance");t.textContent=`Balance: ${Ns()}`,t.className=`balance ${e}`;const s=document.getElementById("all-expenses-list");s&&(s.innerHTML="",E.allExpenses.length>0?E.allExpenses.forEach(r=>{const o=document.createElement("div");o.className="detail-row",o.innerHTML=`
                    <span>${r.day} - ${r.time}</span>
                    <span class="category-badge">${r.category}</span>
                    <span>${r.amount}</span>
                `,s.appendChild(o)}):s.innerHTML="<p>No expenses recorded</p>");const i=document.getElementById("category-breakdown");if(i){i.innerHTML="",Ts.forEach(o=>{const a=(E.expenses[o]||[]).reduce((c,h)=>c+h.amount,0),l=document.createElement("div");l.className="category-row",l.innerHTML=`<span>${o}</span><span>${a}</span>`,i.appendChild(l)});const r=document.createElement("div");r.className="category-row groceries-row",r.innerHTML=`<span>Groceries</span><span>${E.groceries.amount}</span>`,i.appendChild(r)}}async function Ro(){const n=document.getElementById("budget-input"),e=n.value;if(!e||isNaN(e))return;const t=[...E.budgetHistory,{amount:Number(e),date:pt,type:"add"}];E.budgetHistory=t,n.value="",ue(),await ft(z,{budgetHistory:t})}async function ko(){const n=document.getElementById("groceries-input"),e=n.value;if(!e||isNaN(e))return;const s={amount:E.groceries.amount+Number(e),lastUpdated:pt};E.groceries=s,n.value="",ue(),await ft(z,{groceries:s})}async function Ai(n){const t=document.getElementById(`input-${n}`).value;if(!t||isNaN(t))return;const s=Number(t),i={id:Date.now(),amount:s,date:pt,day:So,time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},r={...E.expenses,[n]:[...E.expenses[n],i]},o=[...E.allExpenses,{...i,category:n}];E.expenses=r,E.allExpenses=o,ue(),await ft(z,{expenses:r,allExpenses:o})}async function lf(n,e){const t=window.editValue;if(!t||isNaN(t))return;const s={...E.expenses,[n]:E.expenses[n].map(r=>r.id===e?{...r,amount:Number(t)}:r)},i=E.allExpenses.map(r=>r.id===e?{...r,amount:Number(t)}:r);E.expenses=s,E.allExpenses=i,window.editingExpense=null,ue(),await ft(z,{expenses:s,allExpenses:i})}async function cf(n,e){const t={...E.expenses,[n]:E.expenses[n].filter(i=>i.id!==e)},s=E.allExpenses.filter(i=>i.id!==e);E.expenses=t,E.allExpenses=s,ue(),await ft(z,{expenses:t,allExpenses:s})}document.getElementById("add-budget-btn").addEventListener("click",Ro);document.getElementById("budget-input").addEventListener("keypress",n=>{n.key==="Enter"&&Ro()});document.getElementById("add-groceries-btn").addEventListener("click",ko);document.getElementById("groceries-input").addEventListener("keypress",n=>{n.key==="Enter"&&ko()});document.getElementById("go-to-monthly-btn").addEventListener("click",()=>{document.getElementById("weekly-view").style.display="none",document.getElementById("monthly-view").style.display="block",window.scrollTo(0,0)});document.getElementById("back-to-weekly-btn").addEventListener("click",()=>{document.getElementById("monthly-view").style.display="none",document.getElementById("weekly-view").style.display="block",window.scrollTo(0,0)});sf();
